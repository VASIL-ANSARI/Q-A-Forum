<p>There are a couple of issues above:</p>

<ul>
<li>You're trying to compute <code>factorialLua(divLua)</code> in the script before <code>divLua</code> is set from C++.</li>
<li>You're calling <code>lua_pop</code> with a negative index but it expects a positive integer.</li>
<li>Assuming the first two points are addressed, you're trying to compute <code>125!</code> which is going to be a <em>really</em> large number.</li>
</ul>

<p>Note, the reason you're currently getting <code>1</code> for <code>factorialLua</code> is because <code>lua_tonumber</code> returns <code>0</code> if the given stack index isn't actually a number. Since <code>divLua</code> is still <code>nil</code> when this was called, you are effectively computing <code>factorialLua(0)</code>.</p>

<p>The two obvious ways to go about fixing this:</p>

<ol>
<li>Do a <code>lua_setglobal(L, "divLua")</code> before you actually execute your script.</li>
<li>Move your factorial computation into C++ land to a point where <code>divLua</code> is actually defined.</li>
</ol>
