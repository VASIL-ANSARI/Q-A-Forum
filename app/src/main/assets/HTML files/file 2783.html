<p>This was faster than the equivalent native rails code by a factor of 7:</p>

<pre>
<code>class &lt&lt Foo
  def mass_habtm(attr_array)
    attr_str = attr_array.map{|a| %Q{'#{a}'} }.uniq.join(",")
    self.connection.execute(%Q{insert into foos_bars (foo_id,bar_id) 
                     select distinct foos.id,bars.id from foos,bars 
                     where foos.id = #{self.id} 
                     and bars.some_attribute in (#{attr_str})})
  end
end
</code></pre>

<p>It seems to me that this is a straightforward enough operation that it should be supported efficiently in Rails, I would love to hear if anyone has a cleaner way.  </p>

<p>I'm running 2.2.2, <strike>maybe it's implemented more efficiently in 3.x?</strike>  and found the same on 3.0.2.</p>
