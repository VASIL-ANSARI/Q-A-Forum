<p><a href="http://php.net/unset"><code>unset</code></a> deletes only the reference but not the referenced variable:</p>

<blockquote>
  <p>If a variable that is PASSED BY REFERENCE is <code>unset()</code> inside of a function, only the local variable is destroyed. The variable in the calling environment will retain the same value as before <code>unset()</code> was called.</p>
</blockquote>

<p>So you need to pass the parent array and the key to delete that variable:</p>

<pre><code>function pruneTree(&amp;$parent, $key) {
    $node = &amp;$parent[$key];
    if (!$node['children'] &amp;&amp; !$node['productCount']) {
        unset($parent[$key]);
    }
    if (!empty($node['children'])) {
        foreach ($node['children'] as $key =&gt; &amp;$child) {
            pruneTree($node['children'], $key);
        }
    }
}
</code></pre>
