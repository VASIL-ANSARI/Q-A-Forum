<p>I would go for the following modifications:</p>

<ol>
<li><p>get your legend as an array of objects (instead of strings), each one containing the name as a string and a bollean for active/inactive.</p>

<pre><code>var legendData = d3.set(data.reduce(function (previousValue, currentValue) {
    return previousValue.concat(currentValue.DataPoints.map(function (d) {
        return d.BarValue;   
    }))
}, [])).values();
//Add this:
legendData=legendData.map(function(s){
   return {name:s, active:true};
});
</code></pre></li>
<li><p>map the <code>legendData</code> to your legend objects  </p>

<pre><code>legend.selectAll("g")
    .data(legendData)
    .enter().append("svg:g")
</code></pre>

<p>and remove the former binding:</p>

<pre><code>g.append("svg:rect")
    //.datum(function (d) { return d.DataPoints;}) //remove this
    .attr("rx", li.r)
</code></pre></li>
</ol>

<p>now each legend item knows the corresponding string and its state.</p>

<ol start="3">
<li>use the <code>name</code> field of the data where applicable: for any <code>legendData[i]</code> within the legend part, you should have <code>d.name</code>instead (notice that you're not explicitly referencing <code>legendData</code> anymore, since you've done the binding earlier). There seems to be nothing to do for the <code>active</code> field  (you are already using <code>d.active</code>).</li>
</ol>
