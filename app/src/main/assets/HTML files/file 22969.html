<p>Error messages related to heap corruption such as this message from <code>malloc()</code> indicate that you have memory management bugs, such as using memory after freeing it, or overrunning the allocated memory. It is normal for such <code>malloc()</code> error messages to occur at different locations than where the actual programming error happened. Run your application in Valgrind to get some useful information on what's going wrong.</p>

<p>Unrelated to the error, but you have a memory leak in these two lines of your code above:</p>

<pre><code>DH * params = DH_new(); 
params = DH_generate_parameters(512, 5, NULL, NULL);
</code></pre>

<p>The pointer to the allocated <code>DH</code> structure is overwritten in the second line with a new <code>DH</code> structure returned by <code>DH_generate_parameters()</code>. The buffer allocated by <code>DH_new()</code> is lost. This is not the cause of the error message though.</p>
