<pre><code>DELETE FROM visit 
       WHERE id IN (
               SELECT v2.id 
               FROM visit v1           
               JOIN visit v2
                 ON v1.id &lt; v2.id
                AND v1.user = v2.user                    
                AND TIMESTAMPDIFF(SECOND, v1.timestamp, v2.timestamp) &lt; 5  
               WHERE v1.action = 'visit'         
                 AND v2.action = 'visit'                              
               ) 
</code></pre>
