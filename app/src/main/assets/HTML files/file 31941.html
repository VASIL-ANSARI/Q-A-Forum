<p>Since the friend operator is first declared inside the class, it's only available by argument-dependent lookup. However, neither of its parameter types are in <code>namespace A</code>, so it won't be found. <code>C</code> is an alias for <code>std::map</code>, so is considered to be in <code>namespace std</code> for the purposes of ADL.</p>

<p>There are various ways you could fix it, none of which are perfect:</p>

<ul>
<li>Declare the function in <code>namespace A</code> before the class definition; then it becomes available by normal lookup, not just ADL. However, this breaks the encapsulation somewhat, and might cause problems if anything else tries to overload <code>operator&lt;&lt;</code> for <code>std::map</code>.</li>
<li>Replace the operator overload with a named static (not friend) function, and call it by name.</li>
<li>Declare <code>C</code> as an inner class, rather than an alias for <code>std::map</code>. This enables ADL without breaking encapsulation, but is a bit awkward if you want it to behave just like <code>std::map</code>.</li>
</ul>
