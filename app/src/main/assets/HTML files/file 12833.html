<p>Don't run your whole <code>buildTree()</code> method inside the UI thread.</p>

<p>Instead, run only the changes you want to make to the UI in the UI thread:</p>

<pre><code>protected Void doInBackground(final Void... unused) 
{
    //this part does not block progress, that's OK
    loadDB();
    publishProgress(0);
    buildTree();
    return null;
}
</code></pre>

<p>And then:</p>

<pre><code>public void buildTree()
{
    //build list view within for loop
    int nCnt = getCountHere();
    for(int =0; i&lt;nCnt; i++)
    {
        progDialog.setProgress(0);
        runOnUiThread(new Runnable() {
            public void run() {
                // update your UI here and return
            }
        });
        // now you can update progress
        publishProgress(i);
    }
}
</code></pre>
