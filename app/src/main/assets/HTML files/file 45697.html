<p>I think it's indeed an encoding issue. This is a list of the bytes (part of your string), assuming that string is UTF-16 little endian. Look closely at the bytes around the newline:</p>

<pre><code>119 'w'
  0
104 'h'
  0
101 'e'
  0
114 'r'
  0
101 'e'
  0
 46 '.'
  0
110 'n'
  0
101 'e'
  0
116 't'
  0
 13 CR
 10 LF
  0
 32 ' '
  0
 32 ' '
  0
 76 'L'
  0
 97 'a'
  0
110 'n'
  0
103 'g'
  0
117 'u'
  0
</code></pre>

<p>At some point the UTF-16 byte stream is interpreted as ANSI text, and newlines (<code>"\n"</code>) are expanded to CR-LF pairs, corrupting the UTF-16 string.</p>

<p>The solution depends on how your program works. Do you need to run the program via the CMD command processor? If so, do you use the <code>/U</code> option? Otherwise, can you open the I/O streams in binary mode?</p>
