<p>If I understand correctly process work like that:
1. Data is loaded to staging table Staging_table_A
2. Data is inserted from Staging_table_A itno Table_A with additional column version.</p>

<p>I would do:</p>

<pre><code>with cnt as (select count(*) c, code from Table_A group by code)
Insert into Table_A (select sta.*, nvl(cnt.c,0) + 1 as version 
from Staging_table_A sta left outer join cnt on (sta.code = cnt.code));
</code></pre>

<p>This is based on condition that in Table_A versions contains no duplicates.</p>
