<p>You are adding 3 customers to the lookup with the same key (id)
after the first for loop run the fetch method returns true for the rest of the for loop runs.
so the name will never be set.</p>

<p>You could try this:</p>

<pre><code>    if( $this-&gt;identityMap-&gt;lookup($customer) ) {
        return $this-&gt;identityMap-&gt;get($customer);
    }
</code></pre>

<p>But dont forget to implement the method "get" in the IdentityMap Class ;)</p>
