<pre><code>select
    person_id,
    count(*) over() as total_person,
    rank() over(order by score desc) as score_rank
from (
    select distinct on (person_id) *
    from score
    where category_id = 7
    order by person_id, created desc
) s
</code></pre>

<p>Check <code>rank</code>, <code>dense_rank</code>, <code>percent_rank</code>, <code>ntile</code>, and <code>cume_dist</code>:</p>

<p><a href="http://www.postgresql.org/docs/current/static/functions-window.html" rel="nofollow">http://www.postgresql.org/docs/current/static/functions-window.html</a></p>

<p><code>distinct on</code> returns a single row from each of the <code>person_id</code>s. Using the <code>order by</code> clause it is possible to choose each one.</p>
