<p>For <code>array_map</code> the second argument needs to be an array, so I guess you should be passing <code>$types</code> there and not <code>$filename</code>.</p>

<p>Also, you need to pass at least two arrays into <code>array_intersect</code>. You're actually only passing one there. </p>
