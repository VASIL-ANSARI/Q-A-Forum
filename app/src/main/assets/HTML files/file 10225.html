<p>This is a guess but try this :..</p>

<p>Change:</p>

<pre><code>has_attached_file :photo, :url =&gt; "/:class/:attachment/:id/:style_:basename.:extension"
</code></pre>

<p>To:</p>

<pre><code>has_attached_file :photo, :url =&gt; lambda { |attachment| { :url =&gt; (attachment.match(/mp3/).nil? ? "/:class/:attachment/:id/:style_:basename.mp3" : "/:class/:attachment/:id/:style_:basename.:extension") }
</code></pre>

<p>Just a wild idea. There might be some syntactical damage in there, but maybe it'll push you in the right direction. Sorry :D</p>

<p>You could also do a after_save <code>match</code> and <code>gsub</code> combo.</p>
