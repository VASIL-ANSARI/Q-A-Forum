<p>First of all, allocate() is an internal function - as the docs say (see comment right above the function definition), it is tricky to use and not recommended. Instead, better to just use _malloc to allocate some space, and use setValue to write to it.</p>

<p>Second, make sure your C function takes the structure as a pointer and not a reference (which C++ can do). Paste the function here (original C and compiled JS) so we can help you, or add debug statements inside it to see what is happening.</p>
