<p>You invoked <em>undefined behavior</em> if <code>int</code> is 32-bit long or shorter.</p>

<p>Quote fron <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1256.pdf" rel="nofollow">N1256</a> 6.5.7 Bitwise shift operators</p>

<blockquote>
  <p>If the value of the right operand is negative or is
  greater than or equal to the width of the promoted left operand, the behavior is undefined.</p>
</blockquote>

<p>Try this: <code>mask = n &gt;= 32 ? ~0 : ~((~0) &lt;&lt; (32 - n));</code></p>
