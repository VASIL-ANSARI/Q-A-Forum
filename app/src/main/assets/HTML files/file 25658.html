<p>Try this:</p>

<pre><code>Select Distinct AccountId
From Accounts a
Where Exists
    (Select * From contracts
     Where AccountId = a.AccountId
       And ContractDate &gt;= a.ActivityDate
       And DateDiff(day, a.ActivityDate, ContractDate) &lt;= 30)
</code></pre>
