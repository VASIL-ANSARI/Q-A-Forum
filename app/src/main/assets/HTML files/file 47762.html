<p>If I understand correctly, you want adjacent groups of rows, where "adjacent" is based on <code>contract</code>.</p>

<p>You can do this using a difference of <code>row_number()</code> values.  This difference is constant, when values are adjacent.  The result provide an additional grouping column that provides the information you need:</p>

<pre><code>select t1.*,
       dense_rank() over (order by customer, type1, type2, grp) as partition
from (select t1.*,
             (row_number() over (partition by customer order by contract) -
              row_number() over (partition by customer, type1, type2 order by contract)
             ) as grp
      from table1 t1
     ) t1;
</code></pre>
