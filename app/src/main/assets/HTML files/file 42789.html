<p>This is one way to do it, assuming the array is sorted by time, as it is in the example.</p>

<p><strong>Code</strong></p>

<pre><code>def avg_of_squares(a)
  a.chunk { |t,v| t[0,8] }.map { |t,v|
    [t[0,8], v.reduce(0) { |tot,(_,x)| tot + x*x }/(v.size.to_f)] }
end
</code></pre>

<p>If <code>a</code> were not sorted, first sort it on the first element:</p>

<pre><code>a.sort_by(&amp;:first)
</code></pre>

<p><strong>Example</strong></p>

<pre><code>a = [["00:54:08.349", 14],
     ["00:54:08.349", 13],
     ["00:54:08.449", 20],
     ["00:54:09.349", 15],
     ["00:54:09.628", 21],
     ["00:54:10.679", 13],
     ["00:54:10.839", 12]]

avg_of_squares(a)
  #=&gt; [["00:54:08", 255.0], ["00:54:09", 333.0], ["00:54:10", 156.5]] 
</code></pre>

<p><strong>Explanation</strong></p>

<p>The steps:</p>

<pre><code>e = a.chunk { |t,v| t[0,8] }
  #=&gt; #&lt;Enumerator: #&lt;Enumerator::Generator:0x007fbaac08a2f0&gt;:each&gt; 
</code></pre>

<p>Convert the enumerator to an array to see it's contents:</p>

<pre><code>e.to_a
  #=&gt; [["00:54:08", [["00:54:08.349", 14], ["00:54:08.349", 13],
  #                  ["00:54:08.449", 20]]],
  #    ["00:54:09", [["00:54:09.349", 15], ["00:54:09.628", 21]]],
  #    ["00:54:10", [["00:54:10.679", 13], ["00:54:10.839", 12]]]]

f = e.map
  #=&gt; #&lt;Enumerator: #&lt;Enumerator: #
  #    &lt;Enumerator::Generator:0x007fbaac08a2f0&gt;:each&gt;:map&gt; 
f.to_a
  # (same as for e)
</code></pre>

<p>You can think of <code>f</code> as a "compound enumerator". Pass the first element of <code>f</code> into the block and assign the block variables:</p>

<pre><code>t,v = f.next
  #=&gt; ["00:54:08", [["00:54:08.349", 14], ["00:54:08.349", 13],
  #   ["00:54:08.449", 20]]] 
t 
  #=&gt; "00:54:08" 
v
  #=&gt; [["00:54:08.349", 14], ["00:54:08.349", 13], ["00:54:08.449", 20]]
g = v.reduce(0) { |tot,(_,x)|tot + x*x }/(v.size.to_f)
  #=&gt; 255.0
</code></pre>

<p>so the first element of <code>f</code> is mapped to:</p>

<pre><code>["00:54:08", 255.0]
</code></pre>

<p>The other calculations are performed similarly.</p>
