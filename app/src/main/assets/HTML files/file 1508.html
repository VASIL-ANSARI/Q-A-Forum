<p>I think "gsub" is your friend here:</p>

<pre><code>class UrlParser
  attr_accessor :text, :url_counter, :urls

  def initialize(text)
    @text = parse(text)
  end

  private
    def parse(text)
      @counter = 0
      @urls = []
      text.gsub(%r{(\A|\s+)(http://[^\s]+)}) do
        @urls &lt;&lt; $2
        "#{$1}#{replace_url($2)}"
      end
    end

    def replace_url(url)
      @counter += 1
      "[#{@counter}]"
    end
end

parsed_url = UrlParser.new("one http://x.com/url two")
puts parsed_url.text
puts parsed_url.urls
</code></pre>

<p>If you really need extra fast parsing of long strings, you should build a ruby C extension with <a href="http://www.complang.org/ragel/" rel="nofollow">ragel</a>.</p>
