<p>In your code you are using this string to get the filename twice: <code>$_SERVER['DOCUMENT_ROOT'].'photohive/downloads/file_' . time() . '.zip';</code></p>

<p>In the second time, the <code>time()</code> probably will return the different timestamp, as some seconds will pass while you are compress the images.</p>

<p>Also using the <code>time()</code> method will bring the conflict on hi traffic sites, where you could have a possibility to get two or more requests in one second.</p>

<p>I suggest you to use the <code>tempnam()</code> function to generate the file. And remember to delete it after download is completed.</p>

<p>Here is a code:</p>

<pre><code>$filename = tempnam($_SERVER['DOCUMENT_ROOT'].'photohive/downloads', "zip");
...
$zip-&gt;open($filename, ZipArchive::OVERWRITE);
</code></pre>

<p>And remove this line:</p>

<pre><code>$filename = $_SERVER['DOCUMENT_ROOT'].'photohive/downloads/file_' . time() . '.zip'; 
</code></pre>

<p>after <code>$encoding = 'binary';</code></p>
