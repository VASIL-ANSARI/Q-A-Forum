<p>As mentioned, your issue was caused by missing foreign keyindexes causing a nested loop join based on other criteria.  Adding these indexes solved your problem.</p>

<p>In general in PostgreSQL you should always index all foreign keys (primary keys and unique fields are automatically indexed) on any non-trivially sized tables and then add whatever other indexes you really need.  In this case you were missing foreign key indexes.</p>
