<p>Did you try <a href="http://embeddedjs.com/" rel="nofollow">EmbeddedJS</a>? It is really the kind of templating engine you're currently trying to build on your own :)</p>

<p>Its extremely performant, compiles your templates into JavaScript basically (similar as you describe above) so that you could debug your rendered HTML and has all the stuff build in like fetching templates remotely etc...And most importantly, you write plain JavaScript rather than having to use special tags for looping, conditional clauses and that stuff...</p>

<p><strong>Example of a "rendered" HTML</strong></p>

<pre><code>this.process = (function(_CONTEXT,_VIEW){try { with(_VIEW) { with (_CONTEXT) {var ___v1ew = [];___v1ew.push("&lt;h1&gt;\n");
___v1ew.push("    Account Filtering&lt;/h1&gt;\n");
___v1ew.push("&lt;form id=\"accountFilter\"&gt;\n");
___v1ew.push("&lt;div class=\"filter\"&gt;\n");
___v1ew.push("    &lt;fieldset&gt;\n");
___v1ew.push("        &lt;h1&gt;\n");
___v1ew.push("            Suchkriterien&lt;/h1&gt;\n");
___v1ew.push("        &lt;div class=\"full\"&gt;\n");
___v1ew.push("            &lt;label class=\"description_left\"&gt;\n");
___v1ew.push("                Benutzername:&lt;/label&gt;\n");
___v1ew.push("            &lt;input name=\"username\" type=\"text\" class=\"m\"&gt;\n");
___v1ew.push("        &lt;/div&gt;\n");
___v1ew.push("        &lt;div class=\"full\"&gt;\n");
___v1ew.push("            &lt;label class=\"description_left\"&gt;\n");
___v1ew.push("                Vorname:&lt;/label&gt;\n");
___v1ew.push("            &lt;input name=\"firstname\" type=\"text\" class=\"m\"&gt;\n");
___v1ew.push("        &lt;/div&gt;\n");
___v1ew.push("        &lt;div class=\"full\"&gt;\n");
___v1ew.push("            &lt;label class=\"description_left\"&gt;\n");
___v1ew.push("                E-Mail-Adresse:&lt;/label&gt;\n");
___v1ew.push("            &lt;input name=\"email\" type=\"text\" class=\"m\"&gt;\n");
___v1ew.push("        &lt;/div&gt;\n");
___v1ew.push("        &lt;div class=\"buttons\"&gt;\n");
___v1ew.push("            &lt;input type=\"submit\" name=\"applyFilter\" value=\"Suche\"&gt;\n");
___v1ew.push("            &lt;input type=\"submit\" name=\"btnRemoveFilter\" value=\"Filter lÃ¶schen\"&gt;\n");
___v1ew.push("        &lt;/div&gt;\n");
___v1ew.push("    &lt;/fieldset&gt;\n");
___v1ew.push("&lt;/div&gt;\n");
___v1ew.push("&lt;/form&gt;\n");
; return ___v1ew.join('');}}}catch(e){e.lineNumber=null;throw e;}});
</code></pre>
