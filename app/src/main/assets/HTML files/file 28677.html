<p>If you want to create the result image during this call, you need something like this:</p>

<pre><code>CvMat * thresholdImage (CvMat *img) {
  CvMat *out = cvCreateMat(img-&gt;rows, img-&gt;cols, img-&gt;type);
  for (int i = 0; i &lt; img-&gt;rows; i++)
    for (int j = 0; j &lt; img-&gt;cols; j++) {
      double x;
      if (cvGetReal2D(img, i, j) &lt; 128) x = 0; else x = 255;
      cvSetReal2D(out, i, j, x);
    }
  return out;
}
</code></pre>

<p>Then you'll use it as:</p>

<pre><code>CvMat *out = thresholdImage(img);
</code></pre>
