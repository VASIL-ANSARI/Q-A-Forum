<p>Here is an alternate approach to access the information you want nginx to provide that is much safer.</p>

<p>Include bytes_sent as a column in your access log.</p>

<p>If you refer to the <a href="http://wiki.nginx.org/HttpLogModule" rel="nofollow">HttpLogModule</a> you'll see you can specify bytes_sent as a column in the access log. Combine this with a php script that parses the log file (Perhaps after it is rotated) and you'll be able to avoid c. </p>

<pre><code>log_format sampleformatname '$remote_addr - $remote_user [$time_local]  '
            '"$request" $status '
            '"$http_referer" "$http_user_agent" "$bytes_sent"';

access_log  /path/to/logs/access.log  sampleformatname;
</code></pre>

<p>Some benefits to this approach:</p>

<ul>
<li>Ability to upgrade to newer versions of nginx without merging in your changes.</li>
<li>Stick with the tools you know (php)</li>
<li>offline processing</li>
<li>Simpler and safer</li>
</ul>
