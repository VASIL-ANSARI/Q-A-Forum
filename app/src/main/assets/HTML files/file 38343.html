<p>The problem is most likely not that Ruby is running out of memory while performing this operation (especially since there's only one copy of the <code>h</code> hash), but rather that IRB is running out of memory while trying to display the result. Try adding a <code>; nil</code> after the final line in IRB; that should solve the problem since it will prevent IRB from trying to display the result hash.</p>

<p>Example:</p>

<pre><code>require 'securerandom'
require 'objspace'

h = {}
1..50.times{ h[SecureRandom.hex] = SecureRandom.hex}
a = []
a1 = []
1..100_000.times{ a &lt;&lt; h }
1..100_000.times{ a1 &lt;&lt; h }
a &lt;&lt; a1; nil # Semicolon and nil are for IRB, not needed with regular Ruby

puts "Total memory usage: #{ObjectSpace.memsize_of_all/1000.0} KB"
</code></pre>

<p>I get a result of <code>Total memory usage: 7526.543 KB</code>; no where close to 2 GB.</p>
