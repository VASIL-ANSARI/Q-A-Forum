<p>using this code with gcc 3.3.3 under Cygwin works correctly for me when I call it twice.  You didn't tell us what you're doing outside of these functions, so look there first, e.g. maybe you're accidentally assigning a garbage non-NULL value to app_cfg between calls.  Also, if  you're not using a "big-name" compiler, there's a possibility this is a compiler bug (e.g. it may be overly optimistic at compile time and assume you'll never pass a NULL to destroy_config).  Try putting in something like:</p>

<pre><code>void destroy_config()
{

    /* Check to see if the memory is ok to free */
    if(app_cfg != NULL) {
        printf("not null\n" );
        free(app_cfg);
        app_cfg = NULL;
    }else{
        printf("null\n" );
        }
}
</code></pre>

<p>to see if it really "knows" when it's null.</p>
