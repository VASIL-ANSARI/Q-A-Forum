<p>I show you a sample code related with some ffmpeg encoder.</p>

<pre><code>static int encode_frame(AVCodecContext *avctx, AVPacket *pkt,
                        const AVFrame *pict, int *got_packet) {
    unsigned char *buf;
    int ret, bufLen;
    int64_t maxsize;

    // Store image data to buf variable.
    buf = ....
    // Calculate buf length.
    bufLen = ....

    // Allocate AVPacket.
    maxsize = FF_MIN_BUFFER_SIZE + avctx-&gt;width * avctx-&gt;height * 9;
    if ((ret = ff_alloc_packet2(avctx, pkt, maxsize)) &lt; 0)
        return ret;

    // Copy buf to AVPacket.
    memcpy(pkt-&gt;data, buf, bufLen);
    pkt-&gt;size = bufLen;

    *got_packet = 1;

    return 0;
}
</code></pre>
