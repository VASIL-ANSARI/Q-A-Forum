<p>I need clarification on the following statement you made.</p>

<p><em>"Buy Item A, and you will get either both (Item B + Item C) free, OR only (Item D + Item E) free."</em></p>

<p><strong>Is it only Item D or Item E?</strong></p>

<p>Initially I was thinking this could be solved with some type of referential integrity.</p>

<p>A discount table has the following entries.</p>

<pre><code>(Purchase Item, Free Item)
(A, B)
(A, C)
</code></pre>

<p>Create a foreign key relationship between the [HappyHour_Menu_Subsequent] table and these two columns.  However, this assumes a 1-to-1 relationship.  If you start bundling items, 1-to-1 or 1-to-x, this solution will fail.</p>

<p>Given the fact that the business logic might change, there are two solutions that come to mind.</p>

<p>1 - I would use an INSERT or UPDATE trigger to enforce your business logic if the application does direct inserts and updates to the tables.</p>

<pre><code>CREATE TRIGGER [TRG_ENFORCE_MY_HAPPY_HOUR_DEALS] 
    ON [HappyHour_Menu_Subsequent]
FOR INSERT, UPDATE
AS
BEGIN

-- put your logic here
IF (Violation) 
    RAISERROR();

END
</code></pre>

<p>The Violation is just a place holder.  You will have to look at the inserted and deleted tables to retrieve the purchased item and free item.  Make sure the combination meets your business rules.</p>

<p>Have the front end handle the error if the logic is violated.</p>

<p>2 - If you use stored procedures to perform INSERTS or UPDATES, add the business logic in that code.</p>
