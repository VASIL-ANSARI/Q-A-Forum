<p>To use <code>MiniTest::Rails::Testing.default_tasks &lt;&lt; 'lib'</code> you need to add the <a href="https://github.com/blowmage/minitest-rails">minitest-rails</a> gem to your Gemfile. It is separate from Minitest and adds enables many Minitest features missing that are not enabled in Rails by default. And minitest-rails adds other features, such as creating rake tasks for all the directories that have tests. So without any changes to your Rakefile you can run things like this:</p>

<pre><code>$ rake minitest:lib
</code></pre>

<p>Alternatively, to do this the old fashioned way, you can add the following to your Rakefile:</p>

<pre><code>namespace :test do

  desc "Test lib source"
  Rake::TestTask.new(:lib) do |t|    
    t.libs &lt;&lt; "test"
    t.pattern = 'test/lib/**/*_test.rb'
    t.verbose = true    
  end

end

Rake::Task[:test].enhance { Rake::Task["test:lib"].invoke }
</code></pre>

<p>This assumes you want to run your lib tests without using any database fixtures. If you want the fixtures and database transactions, then you should create the rake task with a dependency on "test:prepare".</p>

<pre><code>namespace :test do

  desc "Test lib source"
  Rake::TestTask.new(:lib =&gt; "test:prepare") do |t|    
    t.libs &lt;&lt; "test"
    t.pattern = 'test/lib/**/*_test.rb'
    t.verbose = true    
  end

end

Rake::Task[:test].enhance { Rake::Task["test:lib"].invoke }
</code></pre>
