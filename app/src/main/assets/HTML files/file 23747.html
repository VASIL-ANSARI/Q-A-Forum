<p>both queries are slow - first because of the subselect in the <code>IN</code> clause - which is not optimized until MySQL 5.6; the second because uses a function in the where clause.</p>

<p>In the first query you can replace the subselect with a join
In the second, it's best to store the domain in separate column and use it for comparision</p>

<p>Make sure you have composite indexes on the fields used in joins, where and group by clauses</p>
