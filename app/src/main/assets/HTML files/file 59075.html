<p>Alright so I kept diging and after a night of sleep I thought about trying something new. </p>

<p>Since I got the problem of already having a custom securityFilter that blocks waffle to perform correctly (even with filter jumping with dispatcher etc).
My eyes caught something interesting.</p>

<p>Waffle set a Header with the name "WWW-Authenticate", so why not try around in that direction. after a couple of hours I got it working. I am performing my own NTLM handshake and read out what I need from the token.
<a href="http://stackoverflow.com/questions/4054564/get-username-from-ntlm-auth-header/5525348#comment67109082_5525348">get username from NTLM auth header</a> helped my quite a lot in understanding how to perform my own NTLM handshake. Basically I customized the source code found there with the help of this masterpeace <a href="https://www.innovation.ch/personal/ronald/ntlm.html" rel="nofollow">NTLM Authentication Scheme for HTTP</a>. Now after seeing how the tokens and packages are built I digged into it and forced my server to requesting this authentication and then after getting the NTLM V3 token, reading out what I need to log in the user.</p>

<p>With this solution I can keep my structure. Only one filter, no wildfly customization but just pure web app logic to get it working.</p>

<p>What is important, is that I still need to configurate the browsers to trust the website I browse, so I don't get the popup asking for credentials. This can be found here <a href="https://github.com/dblock/waffle/blob/master/Docs/ConfiguringBrowsers.md" rel="nofollow">Waffle Doc</a> but I had to add <code>network.negotiate-auth.trusted-uris</code> for firefox and then add the domain (ex: <a href="http://localhost" rel="nofollow">http://localhost</a>) to get the popup to dissapear.</p>

<p>Just thought I would share this if somebody has a similar problem with that sorrounding. </p>
