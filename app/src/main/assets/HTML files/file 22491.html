<p>Running this code whilst the modal dialog is showing is interfering with window activation. </p>

<p>I'm not sure exactly what the mechanism is for this interference, but the fix is simple enough. Move the code outside the dialog. Execute this code immediately after the call to ShowDialog returns.</p>
