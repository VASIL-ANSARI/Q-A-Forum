<p>A few pieces of advice:</p>

<ul>
<li><p>Do not use sprintf and friends to build SQL statements for sqlite3. It is recommended that you use hosted parameters in your statement and bind values to them using the sqlite3_bind functions.</p></li>
<li><p>Always prefer snprintf instead of sprintf and check its output. It will save you from lots of trouble.</p></li>
<li><p>Make sure you run your FUSE filesystem process in the foreground - it makes debugging easier.</p></li>
</ul>

<p>Have you tried breakpoints in gdb? Or a bunch of perror() calls in your code to locate where the errno value that you mentioned comes from?</p>

<p>BTW there is no strtol() call in the code snippet you provided and there are a few macros without their definitions. Also IIRC 13 is the error code for EACCESS.</p>

<p>EDIT:</p>

<p>Something that you may have missed from the <a href="http://fuse.sourceforge.net/doxygen/structfuse__operations.html" rel="nofollow">FUSE API</a>:</p>

<blockquote>
  <p>A major exception is that instead of
  returning an error in 'errno', the
  operation should return the negated
  error value (-errno) directly.</p>
</blockquote>

<p>You seem to be returning errno as-is.</p>
