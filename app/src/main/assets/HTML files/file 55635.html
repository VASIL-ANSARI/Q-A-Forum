<p>Much cleaner implementation </p>

<pre><code>class SomeController &lt; ApplicationController

  before_action :authenticate
  skip_before_action :verify_authenticity_token, if: :json_request?

  def index
    render json: { user: current_user...
  end

protected
  def json_request?
    request.format.json?
  end

  def authenticate
    head :unauthorized unless current_user
  end
end
</code></pre>

<p>I also recommend in using ActiveModel Serializer <a href="https://github.com/rails-api/active_model_serializers" rel="nofollow">https://github.com/rails-api/active_model_serializers</a>. This will separate logic of render json and oy will have a separate class under serializer that defines the json output. So your render method will look like this:</p>

<pre><code>render json: current_user, status: :ok
</code></pre>

<p>app/serializers/user.rb</p>

<pre><code>class UserSerializer &lt; ActiveModel::Serializer
  attribute :id, :email #list your attributes for json output
end
</code></pre>

<p>If you want to test json response in your rspec what I find best is testing against json schema like this library <a href="https://github.com/sharethrough/json-schema-rspec" rel="nofollow">https://github.com/sharethrough/json-schema-rspec</a>.</p>

<p>Hope it helps</p>
