<p>ok, I got it.</p>

<p>This query take all "meta_value" (here: member_id) </p>

<ul>
<li>On all orders where
<ul>
<li>Order status is not : "failed' 'cancelled' or 'refunded'</li>
<li>where order have the product id is 99</li>
<li>Where the order is not into the trash.</li>
</ul></li>
</ul>

<p>so :</p>

<pre><code>SELECT t2.meta_value
FROM wp_woocommerce_order_items AS t1
JOIN wp_woocommerce_order_itemmeta AS t2 ON t1.order_item_id = t2.order_item_id
WHERE t2.order_item_id IN(SELECT DISTINCT oi.order_item_id
FROM wp_posts, wp_postmeta, wp_term_relationships tr,wp_term_taxonomy tt,
     wp_terms te, wp_woocommerce_order_itemmeta oi, wp_woocommerce_order_items ii 
WHERE tt.taxonomy like "shop_order_status"
AND te.term_id = tt.term_id
AND te.slug  NOT IN ('failed','cancelled','refunded')
AND tr.term_taxonomy_id = tt.term_taxonomy_id
AND oi.order_item_id = ii.order_item_id
AND oi.meta_key = '_product_id'
AND oi.meta_value = 99
AND ii.order_id = wp_posts.ID
AND wp_postmeta.post_id = tr.object_id
AND wp_posts.post_status = 'publish') AND t2.meta_key like "member_id"
</code></pre>

<p>I hope to help someOne.</p>

<p>If you have more elegant or more optimisation of this query.</p>

<p>Feel free to tell us :-)</p>
