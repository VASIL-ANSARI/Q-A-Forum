<p>It's dynamic HTML. Mechanize and/or Nokogiri can't help you unless you can build the final version of the page then pass it to them.</p>

<p>Instead you have to use something that can interpret JavaScript and apply CSS, such as a browser. The WATIR project would be the first thing to investigate. "inspect" and "view-source" both reflect the page after the browser has processed the JavaScript and CSS in it, which often has little bearing on what the actual page looked like prior to that. Search SO for <code>[ruby] [watir]</code>.</p>

<p>Use <code>wget</code>, <code>curl</code> or <code>nokogiri</code> to retrieve the page so you can see the raw HTML. </p>

<p><code>$doc.at_css('title')</code> should be using the <code>title</code> method: <code>doc.title</code>. </p>

<p>Don't use a global like <code>$doc</code>. Learn about variable scoping then decide if a global is the right way to go.</p>

<p>Instead of <code>open</code> with a block:</p>

<pre><code>open(url) do |f|
  $doc = Nokogiri::HTML(f)
  title = $doc.at_css('title').text.strip.clone
  re = /\/[a]\/\w{5}/
  s2 = url.match re
  puts title
  puts s2
end
</code></pre>

<p>Do this instead:</p>

<pre><code>doc = Nokogiri::HTML(open(url))
title = doc.title
</code></pre>

<p>When working with URIs/URLs, use the built-in URI class since it's a well debugged tool:</p>

<pre><code>require 'uri'

url = URI.parse('http://imgur.com/a/tGRvr/layout/grid')

url.path # =&gt; "/a/tGRvr/layout/grid"
  .split('/') # =&gt; ["", "a", "tGRvr", "layout", "grid"]
</code></pre>

<p>Knowing that, you can do:</p>

<pre><code>url.path.split('/')[2] # =&gt; "tGRvr"
</code></pre>
