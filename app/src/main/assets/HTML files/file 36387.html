<p>You can't join with tables and columns that are only in a subquery. You would have to change the subquery so that it also returned <code>z.id</code>, and then then join <code>ON zb.fk_id = col2.id</code>. But you don't need a subquery, you can do it all in one query:</p>

<pre><code>SELECT z.name, 
        COALESCE(SUM(IF(zb.what = "repair", zb.price, 0)), 0) AS repair,
        COALESCE(SUM(IF(zb.what = "buy", zb.price, 0)), 0) AS buy
FROM list AS z
LEFT JOIN rec AS zb ON zb.fk_id = z.id
GROUP BY z.id
ORDER BY z.id
</code></pre>
