<p>When working with Node, <a href="https://www.npmjs.com/package/when" rel="nofollow">this is my favourite package</a> for promises:</p>

<p>Simple promise:</p>

<pre><code>return when.promise(function(resolveCallback, rejectCallback) {
        //do something here
    var blah = foo("bar");

    //return callback like this
    resolveCallback();
});
</code></pre>

<p>Chained promise:</p>

<p>return when.promise(function(resolveCallback, rejectCallback) {
        //do something here
    var blah = foo("bar");</p>

<pre><code>//return callback like this
resolveCallback();
</code></pre>

<p>}).then(x);</p>

<pre><code>var x = function(){
     return when.promise(function(resolveCallback, rejectCallback) {
      //do something here
      var blah = foo("bar");

      //return callback like this
      resolveCallback();
        });
};
</code></pre>
