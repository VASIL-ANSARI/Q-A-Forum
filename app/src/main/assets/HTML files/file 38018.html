<p>I'm willing to bet this is your problem:</p>

<pre><code>if l +1 or l-1 in positions[cols[k]]:
</code></pre>

<p>This doesn't mean "if l+1 is in that slot, or l-1 is in that slot". If you meant that (and you almost certainly did), you have to say that:</p>

<pre><code>if l+1 in positions[cols[k]] or l-1 in positions[cols[k]]:
</code></pre>

<p>(There are various ways to write it indirectly, too, like <code>if {l+1, l-1}.intersection(positions[cols[k]])</code>, but I think the explicit version is the obvious way here.)</p>
