<p>First, use a loop like this to walk through your XML:</p>

<pre><code>doc.search('SHOPITEM').each do |shop_item|
  item_id = shop_item.at('ITEM_ID').text
  product = shop_item.at('PRODUCT').text
  description = shop_item.at('DESCRIPTION').text
  # ...
end
</code></pre>

<p>Each iteration that finds a <code>&lt;SHOPITEM&gt;</code> tag will gather the information to create/modify a row.</p>

<p>Instead of using <code>css</code>, which is equivalent to <code>search</code>, you should use <code>at</code> or <code>at_css</code>. Both <code>css</code> and <code>search</code> return a NodeSet, which is like an array. If you use <code>inner_text</code> on a NodeSet that contains more than one node, you'll get all the text nodes concatenated together as a string, which is most likely not what you want and will usually be a bug you have to fix:</p>

<pre><code>require 'nokogiri'

doc = Nokogiri::XML(&lt;&lt;EOT)
&lt;foo&gt;
  &lt;bar&gt;1&lt;/bar&gt;
  &lt;bar&gt;2&lt;/bar&gt;
&lt;/foo&gt;
EOT

doc.search('bar').inner_text # =&gt; "12"
doc.css('bar').inner_text # =&gt; "12"
</code></pre>

<p>For more information, read the documentation for <code>css</code>, <code>search</code>, <code>at</code> and <code>at_css</code> in the <a href="http://nokogiri.org/Nokogiri/XML/Node.html" rel="nofollow">Nokogiri::XML::Node</a> page, along with the <code>inner_text</code> documentation in the <a href="http://nokogiri.org/Nokogiri/XML/NodeSet.html" rel="nofollow">Nokogiri::XML::NodeSet</a> page.</p>
