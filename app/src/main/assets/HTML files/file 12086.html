<ol>
<li><p>Your problem: <code>Hash#merge</code> returns a new hash, you want <code>Hash#update</code>.</p></li>
<li><p>How to do it better? This is not just an advice for testing, but for programming in general: if you update and reuse variables you're gonna hit some problems with state; take a more functional approach. In this particular case you should use <a href="https://github.com/thoughtbot/factory_girl" rel="nofollow">factory_girl</a> or similar gem to easily create objects without having a <code>@valid_attributes</code> being updated who knows where.</p></li>
</ol>
