<p>It's a little more mocking &amp; chaining than I prefer but, you can do this:</p>

<pre><code>subjects = [...]
desc_mock = double("desc order mock")
desc_mock.should_receive(:desc).with(:created_at).and_return(subjects)

conditions = {...}
Subject.should_receive(:all).with(conditions).and_return(desc_mock)
</code></pre>

<p>You could also simplify this a lot by moving your query into a named scope that takes some parameters. Then your test could verify that Subject received your scope with the correct parameters like:</p>

<pre><code>Subject.should_receive(:user_company).with(current_user.id).and_return(subjects)
</code></pre>
