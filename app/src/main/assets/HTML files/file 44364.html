<p>When writing the pixel data, this line</p>

<pre><code>myPic-&gt;pixels[i] = malloc(sizeof(Pixel) *myPic-&gt;cols);
</code></pre>

<p><em>overwrites</em> the existing pointer, and makes it point to new (and more importantly, uninitialized) data.</p>

<p>Copy-paste programming (which you seem to have been doing) can work sometimes, but you have to take care to modify the copied code properly.</p>

<hr>

<p>On an unrelated note, you don't print a newline after each line, so the resulting PPM file will actually not be correct.</p>
