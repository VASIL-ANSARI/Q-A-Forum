<p>You have to open your tag before <code>tagAttributes</code> foreach loop and close after it. There will be also problem if you don't add tagAttributes key to your array, so the tag itself will be omitted.</p>

<p>Example of modification your foreach loop for <code>findAllContents()</code>:</p>

<pre><code>foreach ($tagContents as $tag =&gt; $tagValue) {
    $tmpHtml .= '&lt;' . $tagValue['tagName']

    if (isset($tagValue['tagAttributes'])) {
        foreach ($tagValue['tagAttributes'] as $tagKey =&gt; $value) {
            $tmpHtml .= ' ' . $tagKey . '="' . $value . '"';
        }
    }

    $tmpHtml .= '&gt;&lt;/' . $tagValue['tagName'] . '&gt;';
}
</code></pre>
