<p>Alternatively, you can do it without a transaction because you can combine both queries into one <code>UPDATE</code> statement,</p>

<pre><code>UPDATE  users 
SET     balance = balance - (CASE WHEN email = '$email' THEN $amount ELSE $amount * -1 END), 
        transactions = transactions + 1,
        sent = (CASE WHEN email = '$email' THEN sent + $amount ELSE sent END),
        recv = (CASE WHEN email = '$address' THEN recv + $amount ELSE recv END)
WHERE   email IN ('$email','$address')
</code></pre>

<p>You are using <code>MySQLi</code> but you are not parameterizing the value and in this case you are still vulnerable with <code>SQL Injection</code>.</p>
