<p>With your problem, I would start by choosing between 2 models:</p>

<p>1- Your IM clients establish a session (SIP dialog) with the IM server (or dispatcher or "element" or whatever it is called) and keep it alive for as long as they are running, or signed in. In this case, the SIP dialog is always established from the IM client to the IM server, so the former can be called a SIP client, and the later a SIP server. IM messages are then delivered in both direction on that dialog, using mid-dialog requests. This is probably a good idea, if you know the IM server is routable from anywhere, but the clients are likely to be in private networks.</p>

<p>2- A more symmetric approach is that there is no ongoing dialog. Whenever either entity, IM client or IM server, wants to send a message to the other, then it just uses a one-off out-of-dialog SIP message. In this case, both ends need to implement SIP UA client and UA server functionalities. This could be a preferred solution in any case, when maintaining dialogs between IM clients and servers seems like a bad idea, but routing is not an issue.</p>

<p>Of course, there is a half way solution too, which looks like the second one, but instead of every message being sent on its own, out of a dialog context, a temporary dialog can be established to send messages (and avoid re-authenticating every single message for example) until some inactivity timer takes the dialog down.</p>
