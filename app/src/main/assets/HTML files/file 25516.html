<p>The problem is being caused by you echoing your HTML as it is generated, rather than constructing it as a complete string, then echoing that.  It gets much easier if you do something like:</p>

<pre><code>$imagesPerLine = array(1=&gt;2, 2=&gt;3); $default = 4;
$lines = array(1, 2, 3);
$html="";
foreach ($lines as $line) {
  if (!isset($imagesPerLine[$line])) {
    $imagesPerLine[$line] = $default;
  }
  $html.= "&lt;tr&gt;";
  for ($i = 1; $i &lt;= $imagesPerLine[$line]; $i++) {
   $html.=sprintf("&lt;td&gt;%s&lt;/td&gt;",function_to_generate_image_detail($imagesPerLine[$line]));
  }
  $html.="&lt;/tr&gt;";

}
 echo $html;
</code></pre>

<p>It is hard to determine exactly how you want to generate your image text but, obviously, your function will need to return only </p>

<pre><code>&lt;img name="nummer.1" src="inventory_images/8.jpg" onclick="changecolor(this)" /&gt;
</code></pre>

<p>or whatever else you need.  You seem able to create this bit, so I'll leave that to you.</p>

<p>Note that your code contains other errors, including:</p>

<pre><code>if (($transactionId % $imagesPerLine) == 1)
</code></pre>

<p>where you are using an array as the denominator in a division.  Unwise indeed.  Write the function as I suggested and you will be a happy chap.  Or chapess.</p>
