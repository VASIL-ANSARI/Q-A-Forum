<p>Couple of things:</p>

<p>First, there are some problems with your second pattern.  It is not case insensitive (whereas the first pattern is) so it won't catch things like 'WWW'.  Maybe that's desirable, maybe not.  But it's also global, and is not anchored to the beginning of the URL.  So it will replace www anywhere in the URL.  Changing it to something like <code>/href=\'www/</code> and then changing the replace string to <code>href='http://www</code> should solve these problems.</p>

<p>Secondly, in a case like this, using 2 regular expressions may not be bad.  You can fold it into one regex if you want, but that doesn't mean it is any more efficient for the computer or the poor human who happens to be reading it.</p>

<p>All that said, one way to accomplish this with a single regular expression, is to do something like:</p>

<pre><code>s = message.replace(/\[url=(?:http:\/\/)?([^\]]+)\]\s*(.*?)\s*\[\/url\]/gi, "&lt;a href='http://$1'&gt;$2&lt;/a&gt;")
</code></pre>

<p>This may accomplish what you want.  It does not key off of "www", though, it simply prepends "http://" to any URL that does not already begin with that string.  It also doesn't support https, as you mentioned, but I'm not sure how you will support that anyway.  If all you are given is a URL with no protocol, how do you determine whether or not to make it https?</p>
