<p>How about this query:</p>

<pre><code>SELECT a.*, b.cnt from(
SELECT MAX(Date) AS Date, oid, head
from offs group by oid, head
)a inner join offs b on a.Date=b.Date and a.oid=b.oid and a.head=b.head
</code></pre>
