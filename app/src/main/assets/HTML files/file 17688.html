<p>Try modify your code like below, please check for syntax error since i havent got the chance to try it :)</p>

<pre><code>while ($r = mysql_fetch_array($q)) {
   // open channel header
   $CN  = $r['channel_name'];
   $xml .= "&lt;channel name='".$CN."'&gt;";   

   // event details for channel
   $sql2 = "select * FROM epg where channel_name='".$CN."'";
   $q2  = mysql_query($sql2) or die(mysql_error());
   while($r2 = mysql_fetch_array($q2)) {
      $Mulai      = date('H:i', strtotime($r2['waktu_mulai']));
      $Selesai    = date('H:i', strtotime($r2['waktu_akhir']));
      $Title      = $r2['judul'];
      $Desk       = $r2['sinopsis'];
      $xml .= "&lt;event start='".$Mulai."' end='".$Selesai."'&gt;";
      $xml .= "&lt;title&gt;".$Title."&lt;/title&gt;";
      $xml .= "&lt;description&gt;".$Desk."&lt;/description&gt;"; 
      $xml .= "&lt;/event&gt;";   
   }

   // close channel
   $xml .= "&lt;/channel&gt;";   
}
</code></pre>

<p>you may also see the code here <a href="https://gist.github.com/3797653" rel="nofollow">the code here</a></p>
