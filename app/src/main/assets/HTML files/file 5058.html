<p>Have you thought about using a counting semaphore?</p>
