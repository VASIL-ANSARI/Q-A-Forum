<p>This seems to <a href="http://ideone.com/tUK9Ar" rel="nofollow">do what you want</a>:</p>

<pre><code>transformed_hash = initial_hash
  .group_by { |x| x['name'] }
  .map { |k, v| [k, v.group_by{ |x| x['folder'] }] }
  .to_h
</code></pre>
