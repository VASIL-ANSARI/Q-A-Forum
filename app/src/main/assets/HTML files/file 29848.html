<p>You could use a threadlocal here to keep the g_ID, rather than making using a global. This will work in the scenario, as I understand it, that there may be multiple concurrent calls to <code>process()</code> from different threads, but that the <code>process()</code> method is as shown - that the <code>SendResponse()</code> call will only occur within the scope (runtime scope, not lexical) of the <code>callback()</code> method.  That is true in the code shown. It could be untrue if HandleRequest did something exotic like kick off another thread an then return (but you could certainly ban that by documentation).</p>

<p>The other, more classic, approach is to encapsulate all the state you care about, like g_ID, into a <code>void *</code>, or <code>opaque_state *</code> or whatever, that you pass to the callback, and then methods like <code>SendRespose()</code> take that as an argument.  If you don't like <code>void *</code> you can implement the <code>opaque_state *</code> version without exposing any details of that structure using a forward declaration.</p>
