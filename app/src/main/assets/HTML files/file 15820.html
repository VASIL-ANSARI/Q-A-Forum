<p>The error you are getting says that email is nil. In other words, the deliveries.last method is returning nil because there are no emails in it.</p>

<p>There could be a number of reasons... I'm assuming that you are using cucumber as the testing mechanism?</p>

<p><strong>1. Verify that 'click_button' submits</strong></p>

<p>You could try to put puts or log statements. Make sure that when you run the cucumber feature, it actually prints. Sometimes these things don't work because the front-end logic doesn't work and the test is failing correctly. In other words, the controller endpoint you are expecting to be triggered isn't being triggered.</p>

<p><strong>2. Verify that 'send_email' is right - using a unit test</strong></p>

<p>Next, verify that you are actually sending email. Write a unit test to verify this works. This should be quick and easy to get going. Plenty of articles out there.</p>

<p>Lastly, not really related, but you might want to roll with <a href="https://github.com/bmabey/email-spec" rel="nofollow">email-spec</a> which should provide some nice testing methods so you don't have to reinvent the wheel.</p>
