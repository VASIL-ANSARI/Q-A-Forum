<p>the Camel <a href="http://camel.apache.org/aggregator2.html" rel="nofollow">aggregator</a> and <a href="http://camel.apache.org/message-filter.html" rel="nofollow">filter</a> patterns can be used for this scenario...</p>

<ul>
<li>use a filter to detect "end" messages and route them through an aggregator</li>
<li>use a custom aggregation strategy to build up the single end message with a count </li>
<li>use a custom completion predicate to trigger the completion message</li>
</ul>

<p>something like this...</p>

<pre><code>from("source1").to("direct:aggregateRoute"); 
from("source2").to("direct:aggregateRoute"); 
from("direct:aggregateRoute")
    .filter(header("isEndMessage").isEqualTo("true"))
        .aggregate(constant(true), new MyAggregationStrategy())
        .completionPredicate(new MyCompletionStrategy())
    .to("destination");
</code></pre>
