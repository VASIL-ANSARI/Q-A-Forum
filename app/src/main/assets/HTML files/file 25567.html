<p>As decorators are just functions themselves, you could do the following:</p>

<pre><code>with transaction(_perform_in_transaction, retries=3) as _perf:
    _perf()
</code></pre>

<p>For the details, you'd need to implement <code>transaction()</code> as a factory method that returns an object with <code>__callable__()</code> set to call the original method and repeat it up to <code>retries</code> number of times on failure; <code>__enter__()</code> and <code>__exit__()</code> would be defined as normal for database transaction context managers.</p>

<p>You could alternatively set up <code>transaction()</code> such that it itself executes the passed method up to <code>retries</code> number of times, which would probably require about the same amount of work as implementing the context manager but would mean actual usage would be reduced to just <code>transaction(_perform_in_transaction, retries=3)</code> (which is, in fact, equivalent to the decorator example delnan provided).</p>
