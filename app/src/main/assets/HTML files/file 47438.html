<p>You are trying to download the zip after the webview finished loading the zip file url.. I think the approach should be to stop the webview from loading the zip file url and allow your API to download the file to the desired path.. </p>

<p>Something like the below. The snippet below assumes the zip file url has the extension <code>.zip</code></p>

<pre><code>- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler {

    NSURLRequest *request = navigationAction.request;
    NSString *fileExtension = [[request URL]absoluteString].pathExtension;
    if(fileExtension.length &amp;&amp; [fileExtension caseInsensitiveCompare:@"zip"] == NSOrderedSame){
        //Do not load the zip url in the webview.
        decisionHandler(WKNavigationActionPolicyCancel);
        //Instead use the API to download the file
        [DownloadHandler downloadFileFromURL:[request URL] completion:^(NSString *filepath) {
            NSLog(@"%@",filepath);

        }];
    }

    //Allow all other request types to load in the webview
    decisionHandler(WKNavigationActionPolicyAllow);
}
</code></pre>

<p>Would love to know if this worked for you.</p>
