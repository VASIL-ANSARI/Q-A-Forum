<p>IMHO the question is moot because <code>CUknown</code> as listed on site is incorrect. Specifically:</p>

<pre><code>template &lt;typename T&gt; STDMETHODIMP CUnknown&lt;T&gt;::QueryInterface(REFIID riid,void **ppvObject)
{
...
  if(IsEqualIID(riid,supported_iids[n])) {
    (*ppvObject)=(void*)this;
...
</code></pre>

<p>This implementation does not return a pointer to the desired interface, but a pointer to the start of <code>this</code>. This is incorrect if <code>this</code> implements multiple interfaces (via C++ inheritance). Furthermore, this implementation will always return the same pointer no matter what IID is requested, which cannot possibly be correct for anything more than a trivial object that implements one and only one interface. Not even going into esoteric like COM aggregation and 'outer unknown'. </p>

<p>I recommend you stick with tried and true frameworks like ATL and use <a href="http://msdn.microsoft.com/en-us/library/aehcbwe0.aspx" rel="nofollow"><code>CComObject</code></a> instead. You can look into your SDK <code>atlbase.inl</code> for a correct <code>QueryInterface</code> implementation (see <code>AtlInternalQueryInterface</code> code).</p>
