<p>At the end of the main, you should call for <code>pthread_join</code>, like this:</p>

<pre><code>  ...
  pthread_join(p, NULL);
  pthread_join(x, NULL);
  return 0;
}
</code></pre>

<p>Without that call, the threads are created and when you reach the end of <code>main()</code>, then your program terminates, thus your threads <em>may</em> be able to finish their job, or not, which explains the fact that sometimes your code works.</p>

<blockquote>
  <p>The pthread_join() function shall suspend execution of the calling thread until the target thread terminates, unless the target thread has already terminated.</p>
</blockquote>

<p>Taken from the <a href="http://pubs.opengroup.org/stage7tc1/functions/pthread_join.html" rel="nofollow">manual</a> of <code>pthread_join()</code>.</p>

<p>An almost related question lies <a href="http://stackoverflow.com/questions/13675132/pthread-cond-wait-for-2-threads">here</a>.</p>
