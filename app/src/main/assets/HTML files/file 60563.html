<p>In your spy of <code>then</code> you have <code>return callback(response);</code>, but your callback does not return anything, which is why you get the <code>undefined</code> in your error. The thing you're returning will need to at least have a <code>catch</code> method of some kind attached to it. You can test that with something like this:</p>

<pre><code>var spy= spyOn(mock, 'loadAccounts').andCallFake(function () {
    return {
        then: function (callback) {
            callback(response);
            return {catch: function() {}};
        }
    };
});
</code></pre>

<p>^^ This isn't necessarily how I'd do that, but it should get you moving in the right direction. Consider returning the result of <code>callback(response)</code> wrapped in a <code>Promise</code>.</p>
