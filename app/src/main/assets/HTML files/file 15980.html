<p>Based on the extract from JCiP below, I would have thought that your example should never print "error":</p>

<blockquote>
  <p>The visibility effects of volatile variables extend beyond the value of the volatile variable itself. When a thread <em>A</em> writes to a volatile variable and subsequently thread <em>B</em> reads that same variable, the values of <em>all</em> variables that were visible to <em>A</em> prior to writing to the volatile variable become visible to <em>B</em> after reading the volatile variable.</p>
</blockquote>
