<p>This is <em>not</em> an impossible task (after all, Windows does it!).  Typically, a program's icon is specified in one of two places: within the program binary itself, or in the shortcut to the program.</p>

<ul>
<li><p><strong>Within the program binary:</strong> Windows programs (EXEs and DLLs) use a format called <a href="https://en.wikipedia.org/wiki/Portable_Executable" rel="nofollow">Portable Executable (PE) format</a>.  This file format specifies the organization of code and data for programs.  Icons would be stored somewhere in here.  So, you would need to parse the PE format in order to get the icon.  Thankfully, it looks like Windows provides a function for getting icons: <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms648069%28v=vs.85%29.aspx" rel="nofollow">ExtractIconEx</a>.  You might use this to get an icon from a program.  <a href="http://www.codeproject.com/Articles/9303/Get-icons-from-Exe-or-DLL-the-PE-way" rel="nofollow">Here's</a> an article I found that has some commentary on that function.  Some of the links in it are dead--Google is your best friend.</p></li>
<li><p><strong>In the shortcut:</strong> <a href="http://stackoverflow.com/questions/343200/extract-icon-from-windows-lnk-shortcut-file">Here</a> is an already answered StackOverflow question about getting icons from shortcuts.  Something in there might be helpful.</p></li>
</ul>

<p>Some additional comments:</p>

<ul>
<li>Finding every EXE in the Program Files directories will be slow and useless.  There are plenty of programs in there that nobody wants to use.  What you'll want to do is parse the shortcuts in the Start Menu folder.</li>
<li>From there, you'll want to get the icon from the shortcut.  If that fails, get it from the program itself.</li>
</ul>

<p>I hope this helps.</p>
