<p>In your second form you're never converging any recipe, so obviously there's no resource_collection to test against.</p>

<p>Add a converge(described_recipe) at the end of your runner definition.</p>

<pre><code>let(:chef_run) do
     ChefSpec::Runner.new do |node|
       node.automatic['fqdn'] = 'ceph-1'
       node.set['ceph']['hosts']['ceph-1']
       node.set['ceph']['hosts']['ceph-1']['osd_devices'] = [{device: "/ceph-1-osd", journal: "/ceph-1-journal/journal", type: "directory"}]
     end.converge(described_recipe)
end
</code></pre>
