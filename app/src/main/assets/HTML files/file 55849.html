<p>Your second approach should work, style-wise you can write it much shorter: </p>

<pre><code>sum += shop.quantity.to_i if shop.category == category
</code></pre>

<p><code>nil.to_i</code> is 0, so no matter if <code>shop.quantity</code> is nil or not you can safely add it as long as <code>shop.category == category</code> And if <code>shop.category</code>is nil, it won't be equal to <code>category</code>, so there is no need to ask for it's presence either. </p>

<p>That said, I still think you might want to rethink the way your models are. </p>
