<p>You're calculating the average (but incorrectly - it should be <code>/3</code>, not <code>/2</code>), not the median.</p>

<p>You should pick the middle element of the three.</p>

<p>Something like: (pseudo-code)</p>

<pre><code>sort(left, mid, right)
pick mid
</code></pre>

<p>With your current code, it's likely to end up with a value larger than everything else, so you can possibly end up partitioning off 0 elements to the right, just recursing on the same data towards the left repeatedly.</p>
