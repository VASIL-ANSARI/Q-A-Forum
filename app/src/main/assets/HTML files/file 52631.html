<p>Change from this</p>

<pre><code>if ($parts[0] == $membername) {
    die("Membername not found");
} 
else {
    $file[$n] = $membername . '=' . $displayname;
}
</code></pre>

<p>to this</p>

<pre><code>//when you match you put in array
if ($parts[0] == $membername) {
    $file[$n] = $membername . '=' . $displayname;
    //soon after you got a match put the contents in file and redirect
} 
else {//throw an error
    //die("Membername not found");
    //use this 
    $flag = 1;
}

if(isset($flag)){
   //do what you need to handle the error
}
</code></pre>

<p>Edit2: Try this <a href="http://pastie.org/10742067" rel="nofollow">link</a>.</p>
