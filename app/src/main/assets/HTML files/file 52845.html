<p>You can do this by adding a computed column and then a unique index:</p>

<pre><code>alter table friends UserId_least as (case when UserId &lt; OtherUserId then UserId else OtherUserId end);

alter table friends UserId_greatest as (case when UserId &lt; OtherUserId then OtherUserId else UserId end);

create unique index unq_friends_least_greatest
    on friends(UserId_least, UserId_greatest);
</code></pre>
