<p>You cannot use <code>setTimeout</code> with a generator. It's the generator that you pass to <code>co.wrap</code> that will be ran asynchronously, and <em>it</em> needs to know about the timeout. You will need to <code>yield</code> the timeout (as something <a href="https://github.com/tj/co#yieldables" rel="nofollow">yieldable</a>, like a thunk or a promise):</p>

<pre><code>it('token has expired', co.wrap(function* () {
    yield new Promise(resolve =&gt; { setTimeout(resolve, 1000); });
    let result = yield repository.checkToken(user, token.token);
    result.body.should.have.property("error");
}));
</code></pre>
