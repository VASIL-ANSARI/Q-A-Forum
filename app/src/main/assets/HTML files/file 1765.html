<p>Add code to the beginning of the pattern to capture an opening anchor tag, and then do not perform the callback code when it has captured something:</p>

<pre><code>/(&lt;a[^&gt;]*&gt;)?http:\/\/([,\%\w.\-_\/\?\=\+\&amp;\~\#\$]+)/
</code></pre>

<p>You will then need to add an if to your lamda function to see if there is anything in $matches[1] (Don't forget to increment your captures as well)</p>

<p>You cannot use a negative look behind assertion here as the capture is not a fixed length, but you could use a negative look ahead assertion for the closing tag so it drops the entire match:</p>

<pre><code>/(&lt;a[^&gt;]*&gt;)?http:\/\/([,\%\w.\-_\/\?\=\+\&amp;\~\#\$]+)(?!&lt;\/a&gt;)/
</code></pre>
