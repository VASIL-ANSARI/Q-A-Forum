<p>You should probably use <code>$parser-&gt;getOutput()-&gt;addModules(...)</code> but that's beside the point?</p>

<p>Why do you need the ParserBeforeTidy hook? If you only want to add the script when encountering the parser function, why not do it from the parser function handler method?</p>
