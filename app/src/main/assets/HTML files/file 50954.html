<p>It's almost never a good idea to put HTTP headers in a template/view for exactly the reasons you're citing. Switching to AJAX (in drupal) appears to change (maybe delete) the headers being sent.</p>

<p>You should instead try to put this code in a controller before it reaches a template/view.</p>
