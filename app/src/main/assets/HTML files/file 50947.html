<p>There is a lot of info on the web about executing PS scripts from C# and retrieving whatever (pipeline) output the PS script creates. Here is a blog that describes the process: <a href="http://blogs.msdn.com/b/kebab/archive/2014/04/28/executing-powershell-scripts-from-c.aspx" rel="nofollow">http://blogs.msdn.com/b/kebab/archive/2014/04/28/executing-powershell-scripts-from-c.aspx</a> . Here is the actual API documented: <a href="https://msdn.microsoft.com/en-us/library/dd182449(v=vs.85).aspx" rel="nofollow">https://msdn.microsoft.com/en-us/library/dd182449(v=vs.85).aspx</a> . Note that page has an example as well. </p>

<p>If you are going to be executing a user's script and need to retrieve a variable that it sets (versus a script you write yourself), then you can write a wrapper script that dot sources the user script and then after the user's script completes your wrapper script outputs $path (or whatever other variable you like) to the pipeline, where your C# code will be able to retrieve it.</p>

<p>BTW, I don't think there's any simple way to do what it sounds like you're describing via WMI Invoke. The method described above will work on .Net 2.0.</p>

<p>One thing you might think of to do, to achieve this is for the process created by wmi.invoke to alter it's parent's (your C# service) environment. However as explained here: <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms682009(v=vs.85).aspx" rel="nofollow">https://msdn.microsoft.com/en-us/library/windows/desktop/ms682009(v=vs.85).aspx</a> that's not possible (see the Community comments at the bottom of the page for more depth).</p>
