<p>So we want to find students for whom there are no students in other grades they have a friendship relationship, right? This is one way to express that:</p>

<pre><code>select * from highschooler h
where not exists
(select 1 from highschooler h2 where h2.grade != h.grade and exists
(select 1 from friends f where (f.id1 = h.id or f.id2 = h.id) and (f.id1 = h2.id or f.id2 = h2.id)))
order by grade, name
</code></pre>

<p>EDIT: If you also require them to have at least one friend, you'll need to check for that too</p>
