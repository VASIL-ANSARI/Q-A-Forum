<p>No, this is not an atomic block of code. Calling into the code multiple times quickly can call <code>find</code> multiple times before updating and therefore not run the update you intend. MongoDB has atomic updates if you use the various <a href="https://docs.mongodb.org/manual/reference/operator/update/" rel="nofollow">update operators</a> instead of reading values, updating them in code then writing the values back.</p>

<p><code>inc</code> is the easiest one to use as an example. You could write code to read a number, increment it, then write the updated value back. However if that code was called concurrently, it could read the value twice, both calls increment the number to the same value, and one of those writes 'wins' - incrementing the value once instead of twice. Using <code>inc</code> however handles this case atomically (consider your <a href="https://docs.mongodb.org/manual/reference/write-concern/" rel="nofollow">write concern</a> carefully).</p>

<p>To answer your question more specifically, the "Do something based off of fields in document..." needs to be something achievable using MongoDB update operators.</p>
