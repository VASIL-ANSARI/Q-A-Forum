<pre><code>require 'socket'

def read_until(socket, re)
  accu = ''
  re = Regexp.escape(re) if String === re
  re = /#{re}\Z/
  socket.each_char do |c|
    accu &lt;&lt; c
    return accu if re === accu
  end
  return accu
end

socket = Socket.new(Socket::AF_INET, Socket::SOCK_STREAM, 0 )
sockaddr = Socket.pack_sockaddr_in(80, 'www.google.com')
socket.connect(sockaddr)
socket.write "GET / HTTP/1.0\n\n"
headers = read_until(socket, /\r\n\r\n/)
body = socket.read
puts "HEADERS:\n#{headers}BODY:\n#{body}"
</code></pre>
