<p><code>Mysql()</code> is deprecated and is one of your biggest concern right now. Consider using <code>mysqli</code> or <code>PDO</code> instead. Learn more <a href="http://www.php.net/manual/en/intro.mysql.php" rel="nofollow">here</a></p>

<p>It's possible the "hacker" is using a web shells in an image, read more about that <a href="http://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/" rel="nofollow">here</a></p>

<p>Another method I can think of is not through PHP but via your database. Since your using <code>mysql()</code>Make sure the privileges are set properly for each user (especially if root or anonymous exist), less generic privileges for each user is best.. I'd recommend changing your password if there's been any indication of unauthorized access. </p>

<p>Check your ftp logs and server logs to see if any images or files have been altered, see if there are any unauthorized logins. Don't use IP Addresses as a reference like you mentioned in the comments, instead look closer at files edited and password attempts.</p>
