<p>You should not store the result in a field in the <code>Sales</code> table, otherwise you need to recalculate the result every time the details change.  You should create a view for this:</p>

<pre><code>CREATE VIEW SalesView
AS
SELECT 
    SaleDate date,
    SalerZip varchar(255),
    A.ProductID,
    AVG(B.Price) AveragePrice
FROM Sales A
INNER JOIN Details B
ON DATEDIFF(Day,A.SaleDate, -30) &lt;= B.ListSaleDate
    AND B.ListSaleDate &lt; A.SaleDate
    AND A.ProductID = B.ProductID
    AND A.SalerZip = B.SalerZip and B.buyerDistance &lt; 200
GROUP BY A.SaleDate,
    A.SalerZip,
    A.ProductID
</code></pre>
