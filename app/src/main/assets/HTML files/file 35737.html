<p>It is downloading because you are writing it to the response output. You should be writing the attachment content to a temporary file/memory and attach that.</p>

<p>Also there is no need to set those headers.</p>

<p>The accepted answer to the SO question you have referenced is incorrect, the other answer is best <a href="http://stackoverflow.com/a/15453323/2018227">http://stackoverflow.com/a/15453323/2018227</a></p>
