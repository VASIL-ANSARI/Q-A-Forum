<p>You are returning the address of a local variable. When the function ends, that variable goes out of scope, and accessing its old address is an illegal operation that will trigger undefined behavior.</p>

<p>You must use <code>malloc()</code> to allocate heap memory that will persist.</p>

<p>Also, I recommend against <code>typedef</code>:ing away the pointer asterisk in C, it's very confusing. The scalar fields (size) should not be <code>int *</code>, they're <em>not</em> pointers!</p>

<p>You should do something like:</p>

<pre><code>struct OneArrayImage {
  int w;
  int h;
  int len;
  unsigned char* pix;
};

struct OneArrayImage * image(char* pix, int len, int w, int h)
{
  struct OneArrayImage *img = malloc(sizeof *img);
  if(img != NULL)
  {
   img-&gt;w = w;
   img-&gt;h = h;
   img-&gt;len = 3 * w * h * len;
   img-&gt;pix = pix;
  }
  return img;
}
</code></pre>
