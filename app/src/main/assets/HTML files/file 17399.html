<p><code>sizeof(*b)</code> in the <code>memcpy</code> is your problem, you just get the size of one double.  You need to store the size used in <code>malloc</code> in a variable (or constant) and use that.</p>
