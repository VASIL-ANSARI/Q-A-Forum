<p>Are you concerned about optimizing out the file open operation? I think you are making it way more complex and error prone than what it should be. File pointers (<code>FILE*</code>) are not thread-safe structures so you cannot share them across threads.</p>

<p>What you probably need to do (if you <em>really</em> want to cache the file open operations) is to keep a dictionary mapping filename to a file <em>descriptor</em> (an <code>int</code>) and have a thread-safe function to return a descriptor by name or open if it's not in the dictionary.</p>

<p>And of course doing I/O to the same file descriptor from multiple threads needs to be regulated as well.</p>
