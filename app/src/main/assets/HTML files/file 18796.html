<p><code>png</code> variable is uninitialized on the first call to Image.frombuffer(). You need to initialize it to something from stdin.</p>

<p>I'm not sure about your use of <code>for linha in sys.stdin:</code>. That gives you line-buffered input. You probably want to use block buffered input of size N, like sys.stdin.read(N). This will read a specific number of bytes and then you can parse the data, like cutting your filename delimiter out and filling the input buffer for Image.frombuffer().</p>
