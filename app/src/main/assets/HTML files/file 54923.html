<p>I know this question is over a year old, but I was struggling to do the same thing using golang.  </p>

<p>After downloading the source code for wss4j, and running their signature tests, I found that you don't actually sign the digest value determined in step 3, but rather, you take the entire <code>&lt;ds:SignedInfo&gt;&lt;/ds:SignedInfo&gt;</code> block canonicalize it, and then sign it.  Wss4j also adds the soap namespace to the element before canonicalization, in case you aren't using a DOM that adds parent namespaces, otherwise your signature will fail verification.  I'm not using Go's DOM and as such I had to make sure to add the xmlns:soap to the signed info element.</p>

<p>I don't know if the added namespace follows the WSSE spec or not, but those were my findings, and I was able to successfully make a signed SOAP message from golang to a java service using this technique.</p>

<p>An example of what you would sign, keep in mind spacing between tags matters in c14n, so I left this unformatted with no spaces between.</p>

<p><code>&lt;SignedInfo xmlns="http://www.w3.org/2000/09/xmldsig#" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;&lt;CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"&gt;&lt;InclusiveNamespaces xmlns="http://www.w3.org/2001/10/xml-exc-c14n#" PrefixList="real soapenv wsu"&gt;&lt;/InclusiveNamespaces&gt;&lt;/CanonicalizationMethod&gt;&lt;SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"&gt;&lt;/SignatureMethod&gt;&lt;Reference URI="#id-65BB4C5D722C51E896140612427983429"&gt;&lt;Transforms&gt;&lt;Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"&gt;&lt;InclusiveNamespaces xmlns="http://www.w3.org/2001/10/xml-exc-c14n#" PrefixList=""&gt;&lt;/InclusiveNamespaces&gt;&lt;/Transform&gt;&lt;/Transforms&gt;&lt;DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"&gt;&lt;/DigestMethod&gt;&lt;DigestValue&gt;YIjV+XTiwlkXLG4yMhwuxXeHGYE=&lt;/DigestValue&gt;&lt;/Reference&gt;&lt;/SignedInfo&gt;</code></p>
