<ol>
<li><p><code>mod_rewrite</code> can't do geolocation, nor can it connect to an external service</p></li>
<li><p>If your PHP code is doing the 301 redirect, then you'll need to preserve the query string in your PHP code. If you have an htaccess rule doing the 301 redirect, then the query string should be passed through with the redirect.</p></li>
</ol>

<p><a href="https://httpd.apache.org/docs/current/mod/mod_rewrite.html" rel="nofollow">The documentation</a> states:</p>

<blockquote>
<b>Modifying the Query String</b>
<br><br>
By default, the query string is passed through unchanged. [...] When you want to erase an existing query string, end the substitution string with just a question mark. To combine new and old query strings, use the [QSA] flag.
</blockquote>
