<p>I would get rid of the "AND WHERE" in the second part of the if statement and replace it with just "AND"</p>

<p>Without knowing more about the issue (such as the error message), it seems that's the most obvious syntax issue.</p>

<p>edit: to answer the larger question, I don't think this is the best way to do it. I'll let the experts hit on that part, but I would probably load all the records and all the spam rules and do the filtering after the DB queries. SQL isn't great at full-text searching, IME.</p>
