<p>This is the "infamous loop problem."</p>

<p>The problem is here:</p>

<pre><code>xhr.upload.onprogress = function(e) 
{
    $('#' + progress).attr('value', e.loaded);
    $('#' + progress).attr('max', e.total);
};
</code></pre>

<p>When this function runs, <code>progress</code> will be whatever it was when the loop exited, not what it was at the point in the loop where the function was defined. Try replacing that code with something like this:</p>

<pre><code>(function(progress) { 
    xhr.upload.onprogress = function(e) 
    {
        $('#' + progress).attr('value', e.loaded);
        $('#' + progress).attr('max', e.total);
    };
}(progress));
</code></pre>

<p>More: <a href="http://stackoverflow.com/questions/1451009/javascript-infamous-loop-problem">Javascript infamous Loop problem?</a></p>
