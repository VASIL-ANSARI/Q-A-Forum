<p>Capturing snapshots of profiling information automatically is possible with several Java profilers, you have to add VM parameters to the Java start command to load the profiler and you have to tell the profiler to record data and save a snapshot on exit.</p>

<p>In <a href="http://www.ej-technologies.com/products/jprofiler/overview.html" rel="nofollow">JProfiler</a>, you could use the <a href="http://resources.ej-technologies.com/jprofiler/help/doc/offline/ant.html" rel="nofollow">"profile" ant task</a> to do this. It takes the profiling settings from a config file that is exported from the JProfiler GUI. You can use the <a href="http://resources.ej-technologies.com/jprofiler/help/doc/offline/javadoc/com/jprofiler/api/agent/Controller.html" rel="nofollow">Controller API</a> to start recording and save a snapshot.</p>

<p>Then you have two choices:</p>

<ol>
<li><p>You can use the <strong>jpcompare</strong> command line utility or the corresponding <a href="http://resources.ej-technologies.com/jprofiler/help/doc/export/antComparisons.html" rel="nofollow">"compare" ant task</a> to compare the snapshot against a known baseline. There are <a href="http://resources.ej-technologies.com/jprofiler/help/doc/export/cmdlineComparisons.html" rel="nofollow">several comparisons available</a>. You can export the results as HTML or in a machine-readable format (CSV/XML).</p></li>
<li><p>You can extract data from the snapshot with the <strong>jpexport</strong> command line utility or the corresponding  <a href="http://resources.ej-technologies.com/jprofiler/help/doc/export/antExport.html" rel="nofollow">"export" ant task</a>. Then you can write your own code to analyze the profiling data from a particular run.</p></li>
</ol>

<p>For a limited set of profiling data, it is actually possible to use the JProfiler API to write your own profiler that does something like the <code>Profiler.getTotalCallsMadeTo(Foo.class, "barMethod")</code> in your example. See the <code>api/samples/platform</code> example in a JPofiler installation. You would get the information from the hot spot data. </p>

<p>However, for making assertions on whether a specific method was called I would suggest to take an AOP-based approach. Using a profiler-based approach is appropriate for detecting performance regressions.</p>

<p>Disclaimer: My company develops JProfiler.</p>
