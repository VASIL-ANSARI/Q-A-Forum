<p>The 2-D code is ridiculously inefficient.  You don't need any trigonometry at all.  It's just multiplying the magnitude of the of the force, <code>f</code>, by a unit vector in the (dx, dy) direction.  Given that you already know the length of the vector, <code>d</code>, all you need is</p>

<pre><code>fx, fy = f*dx/d, f*dy/d
</code></pre>

<p>In 3-D </p>

<pre><code>fx, fy, fz = f*dx/d, f*dy/d, f*dz/d
</code></pre>
