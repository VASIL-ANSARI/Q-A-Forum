<p>I'm fairly sure that this line:</p>

<pre><code>jloop:
    mov eax,    [ebp-24] ;height
</code></pre>

<p>should be:</p>

<pre><code>jloop:
    mov eax,    [ebp+24] ;height
</code></pre>

<p>As it is, your upper bound for the <code>jloop</code> is using some random value from elsewhere on the stack, not <code>height</code></p>
