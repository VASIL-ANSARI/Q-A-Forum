<p>Better group the sub table that has multiple data with the same group of your outer group by columns.In your case the <code>VisitaMaquina</code> and <code>reporteproducto</code> should be group by with <code>visita_id, producto_id</code> since they all have repeat rows with the same combination of <code>vid=31 and pid=1</code>.  </p>

<p>You can change the <code>visitamaquina vm</code> and <code>reporteproducto rp</code> table alias to sub query form of the following:</p>

<pre><code>(select visita_id, Producto_Id, sum(Total) as Total from visitamaquina 
 group by visita_id, Producto_Id) vm,  
(select Producto_Id, Visita_Id, sum(Quantity) as Quantity from reporteproducto
 group by Producto_Id, Visita_Id) rp
</code></pre>

<p>Also I found that there is <code>vm.maquina_id</code> in your where clause, maybe this causes your problem.Because if the <code>visitamaquina</code> and <code>reporteproducto</code> both have repeat values of <code>visita_id, producto_id</code> then the output should have <code>Total, Quantity</code> both doubled.In your output the <code>Quantity</code> is right, that's odd.</p>
