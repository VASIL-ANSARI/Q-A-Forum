<p>You're declaring the pointer <code>rand</code>, but never initializing it. As a result, <code>remove_item</code> is trying to indirect through this unitialized pointer, which is undefined behavior,</p>

<p>You can just declare a normal variable, and pass its address to the <code>remove</code> function:</p>

<pre><code>buffer_item consumed;
int p = remove_item(&amp;consumed);
</code></pre>
