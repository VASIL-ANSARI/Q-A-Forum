<p>Try this code for encode and decode, working fine for me, you may need to use <code>uchar</code> to store data.</p>

<pre><code>Mat src=imread("src.jpg",1);
vector&lt;uchar&gt; buf;
imencode(".jpg",src,buf);

Mat dst=imdecode(buf,1);
imshow("src",src);
imshow("dst",dst);
</code></pre>
