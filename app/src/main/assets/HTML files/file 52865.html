<p>You don't need your own function; <code>row_number()</code> does this for you:</p>

<pre><code>select m.*, 
       row_number() over (partition by topic order by message_global_id) as seqnum
from messages m;
</code></pre>

<p>I missed that you want an <code>update</code>:</p>

<pre><code>update messages m
    set message_nb_in_topic = mm.seqnum
    from (select m.*, 
                 row_number() over (partition by topic order by message_global_id) as seqnum
          from messages m
         ) mm
    where m.message_global_id = mm.message_global_id;
</code></pre>
