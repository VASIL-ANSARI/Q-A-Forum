<blockquote>
  <p>It may be that the AppWidgetService
  (located in the Android source's
  Base.git at
  \src\base\services\java\com\android
  \server), which loads the list of
  available widgets, caches this list of
  available widgets.</p>
</blockquote>

<p>It does, near as I can tell. It stores the list in <code>mInstalledProviders</code>; this list is added to via <code>readStateFromFileLocked()</code>, which appears to be called from the system startup logic.</p>

<blockquote>
  <p>If that were the case, though, then
  the above code which enables or
  disables the widget component would
  work after a device reset because
  there would be no cache; it does not.</p>
</blockquote>

<p>You assume a RAM cache. The cache is an XML file.</p>

<blockquote>
  <p>This, unfortunately, populates the
  list directly from the
  AppWidgetService, without any
  filtering for the component's enabled
  status</p>
</blockquote>

<p>And this would appear to be a bug in Android. More generally, the whole caching thing I would think is the bug -- I see no way to recover if that cache gets out of sync.</p>

<p>I would recommend you post your writeup as an issue on the <a href="http://b.android.com" rel="nofollow">public Android issue tracker</a>, if you have not done so already.</p>
