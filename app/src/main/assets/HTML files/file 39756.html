<p>Finaly figured it out. </p>

<p>The problem was that I didnt notice that <code>fs.readFileSync</code> had no callback funtction.</p>

<p>So the proper use for that function should have been </p>

<pre><code>var result= fs.readFileSync(pathToFile,{options})
return result;
</code></pre>

<p>I can still use some help on the problem i mentiond with <code>next(connection);</code>. I dont realy know why it skips whole parts of code like that. </p>
