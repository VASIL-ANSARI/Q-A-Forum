<p>Without knowing the value of <code>fileName</code> this is a bit of a guess, but I believe your problem is that you are waiting for the shell to exit, but the shell starts another process to open the file and doesn't wait for that process to exit.</p>

<p>For example, if you try to open an Excel spreadsheet this way, the shell will lookup the registry and determine that the way to open a spreadsheet is to run Excel (if not already running) with a command line flag that prevents it creating a blank worksheet, and then send it a DDE command to tell it to open the worksheet. The shell then exits, your <code>wait</code> completes, but the file is still open (or may even not yet have opened).</p>

<p>If you want to wait for completion you need at the very least to run the actual command that opens the file, and not depend on the shell's automated lookup. That may still not be enough if the application is already running as some applications may detect an existing instance so your wait would only work if the application is not already running.</p>

<p>There probably isn't any simple clean way to do what you want. The best I can suggest is that if the <code>os.remove()</code> call fails you use a polling loop, sleep for 1 second and then try again, but you may still have problems if the file hasn't actually been opened by the time the <code>wait()</code> call completes.</p>
