<p>This is why the AUTO_INCREMENT feature exists, so concurrent transactions can generate unique primary key values.</p>

<p>To do this with your own code, you would have to use <a href="http://dev.mysql.com/doc/refman/5.1/en/lock-tables.html" rel="nofollow"><code>LOCK TABLES Purchase WRITE</code></a> before calling <code>getAmountForClient()</code>, to prevent the race condition with other transactions that causes the duplicate key errors.</p>

<p><strong>No one does this.</strong>  They forego the idea of custom primary keys as you have described, and just use AUTO_INCREMENT instead.</p>
