<p>You can use a <code>join</code>:</p>

<pre><code>update recordset t join
       (select ContractNumber, max(ReferenceNumber) as ReferenceNumber
        from recordset t
        group by ContractNumber
       ) tt
       on t.ContractNumber = tt.ContractNumber
    set t.ReferenceNumber = tt.ReferenceNumber
    where t.ReferenceNumber is null;
</code></pre>
