<p><code>withDocumentBuilderFactory</code> is exactly what you want to use but unfortunately <code>ignoreWhitespace</code> defeats it.</p>

<p>Under the covers <code>DiffBuilder</code> creates a <code>WhitespaceStrippedSource</code> which creates a DOM <code>Document</code> without using the <code>DocumentBuilderFactory</code> you've configured. This is a bug. Do you want to create an issue for this?</p>

<p>A workaround using XMLUnit 2.2.0 is to create the <code>Document</code>s yourself, something like</p>

<pre><code>Document control = Convert.toDocument(Input.fromString(...).build(), dbf);
Document test = ...
Diff d = DiffBuilder.compare(Input.fromDocument(control))
             .withTest(Input.fromDocument(test))
             .ignoreWhitespace().build();
</code></pre>

<p><em>Edit:</em> The bug has been fixed in XMLUnit 2.2.1 and the code of the question should now work without any changes.</p>
