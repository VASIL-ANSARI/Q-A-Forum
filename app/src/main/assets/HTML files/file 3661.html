<p>Looks like you need an else after</p>

<pre><code>if(bodypos==std::string::npos)
{
    HttpError(...);
}
</code></pre>

<p>otherwise you are calling substr with bodypos = npos</p>
