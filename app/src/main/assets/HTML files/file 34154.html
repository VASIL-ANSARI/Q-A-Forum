<p><strike>This appears to be a bug with Apple's OpenCL implementation. According to <code>clGetDeviceInfo(..., CL_DEVICE_VERSION, ...)</code>, the Intel HD4000 supports OpenCL 1.2 under OS X 10.9. This means that it <em>has</em> to support double precision, since this is a core feature as of OpenCL 1.2. I've just tested an even simpler double precision kernel on my own HD4000, and it's just completely broken. I'll be filing a bug against this, but if you wish to do the same, you can use the <a href="https://developer.apple.com/bug-reporting/" rel="nofollow">Apple Bug Reporting System</a>.</p>

<p>You shouldn't need to enable the <code>cl_khr_fp64</code> extension using <code>#pragma</code> in your kernel either, but removing this causes the program to fail to build (which is also a bug).</strike></p>

<p>I was mistaken when writing the above - double precision was changed from an optional extension to a core optional feature in OpenCL 1.2; it is not mandatory to support it. You can query whether a particular device supports double precision by calling <code>clGetDeviceInfo(..., CL_DEVICE_DOUBLE_FP_CONFIG, ...)</code> and checking for a non-zero value (which indicates that it is indeed supported). I've just tried this on a HD4000 under OS X and it returns <code>0</code>.</p>

<p>That said, if double precision isn't supported, I'd expect the compiler to throw an error when trying to compile a kernel that uses it, so this is still a bug in my book.</p>
