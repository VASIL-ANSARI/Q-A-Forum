<p>You're missing a final <code>\r\n</code> at the end of your handshake response</p>

<p>See the HTTP <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec6.html#sec6" rel="nofollow">rfc2616</a></p>

<pre><code>   Response      = Status-Line               ; Section 6.1
                   *(( general-header        ; Section 4.5
                    | response-header        ; Section 6.2
                    | entity-header ) CRLF)  ; Section 7.1
                   CRLF
                   [ message-body ]          ; Section 7.2
</code></pre>

<p>Your code is missing the <code>CRLF</code> after the response.</p>

<p>Once you get the handshake working, the line <code>socket.write("test");</code> won't work as you expect.  Websocket messages are <a href="http://tools.ietf.org/html/rfc6455#section-5" rel="nofollow">framed</a> so you'll need additional code to read and write messages.</p>
