<p>You are right, you are creating the association/link between configurable and child products but what's happening is that when you are creating your configurable product you are not setting up the <strong>setConfigurableAttributesData</strong> that basically setups the superattribute information for that configurable product.</p>

<pre><code>    foreach($configAttrCodes as $attrCode){

        $super_attribute= Mage::getModel('eav/entity_attribute')-&gt;loadByCode('catalog_product',$attrCode-&gt;code);
        $configurableAtt = Mage::getModel('catalog/product_type_configurable_attribute')-&gt;setProductAttribute($super_attribute);

        $newAttributes[] = array(
           'id'             =&gt; $configurableAtt-&gt;getId(),
           'label'          =&gt; $configurableAtt-&gt;getLabel(),
           'position'       =&gt; $super_attribute-&gt;getPosition(),
           'values'         =&gt; $configurableAtt-&gt;getPrices() ? $configProduct-&gt;getPrices() : array(),
           'attribute_id'   =&gt; $super_attribute-&gt;getId(),
           'attribute_code' =&gt; $super_attribute-&gt;getAttributeCode(),
           'frontend_label' =&gt; $super_attribute-&gt;getFrontend()-&gt;getLabel(),
        );
    }

    $existingAtt = $product-&gt;getTypeInstance()-&gt;getConfigurableAttributes();

    if(empty($existingAtt) &amp;&amp; !empty($newAttributes)){
        $configProduct-&gt;setCanSaveConfigurableAttributes(true);
        $configProduct-&gt;setConfigurableAttributesData($newAttributes);
        $configProduct-&gt;save();

    }
</code></pre>

<p>This is small snippet should get you there, let me know if you have any questions or need further help.</p>
