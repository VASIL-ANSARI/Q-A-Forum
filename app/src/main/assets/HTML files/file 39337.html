<blockquote>
  <p>I am using <code>boost::shared_ptr</code> however for simplicity I did not mention it here</p>
</blockquote>

<p>Ironically, that is the very thing that's making your code fail to compile. Without it, the example you've shown compiles without errors. </p>

<p>The problem is that you're trying to use <code>boost::make_shared</code> to create the <code>shared_ptr</code>. This will lead to <code>make_shared</code> attempting to construct a <code>foo</code>, which of course fails, because you've declared <code>bar</code> to be a <code>friend</code> of <code>foo</code>'s, but <code>make_shared</code> isn't a <code>friend</code>.</p>

<p>Use the <code>shared_ptr</code> constructor directly instead, and pass it a pointer to a <code>foo</code> object that has been allocated by <code>bar</code>.</p>

<p><a href="http://coliru.stacked-crooked.com/a/cc6d15fc1a13ac2f" rel="nofollow">Live demo</a></p>

<hr>

<p>Note that declaring <code>boost::make_shared</code> as a <code>friend</code> is not a reliable solution either because it may delegate the actual construction to some other function.</p>
