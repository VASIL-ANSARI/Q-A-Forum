<p>Note that</p>

<pre><code>n! = 2 * 3 * ... * n
</code></pre>

<p>so that</p>

<pre><code>log(n!) = log(2 * 3 * ... * n) = log(2) + log(3) + ... + log(n)
</code></pre>

<p>This is important because if <code>k</code> is a positive integer then the ceiling of <code>log(k)</code> is the number of digits in the base-10 representation of <code>k</code>. Thus, these lines of code are counting the number of digits in <code>n!</code>.</p>

<pre><code>p = 0.0;
for(j = 2; j &lt;= n; j++)
    p += log10(j);
d = (int)p + 1;
</code></pre>

<p>Then, these lines of code allocate space to hold the digits of <code>n!</code>:</p>

<pre><code>a = new unsigned char[d];
for (i = 1; i &lt; d; i++)
    a[i] = 0; //initialize
</code></pre>

<p>Then we just do the grade-school multiplication algorithm</p>

<pre><code>p = 0.0;
for (j = 2; j &lt;= n; j++) {
    q = 0;
    p += log10(j);
    z = (int)p + 1;
    for (i = 0; i &lt;= z/*NUMDIGITS*/; i++) {
        t = (a[i] * j) + q;
        q = (t / 10);
        a[i] = (char)(t % 10);
    }
}
</code></pre>

<p>The outer loop is running from <code>j</code> from <code>2</code> to <code>n</code> because at each step we will multiply the current result represented by the digits in <code>a</code> by <code>j</code>. The inner loop is the grade-school multiplication algorithm wherein we multiply each digit by <code>j</code> and carry the result into <code>q</code> if necessary.</p>

<p>The <code>p = 0.0</code> before the nested loop and the <code>p += log10(j)</code> inside the loop just keep track of the number of digits in the answer so far.</p>

<p>Incidentally, I think there is a bug in this part of the program. The loop condition should be <code>i &lt; z</code> not <code>i &lt;= z</code> otherwise we will be writing past the end of <code>a</code> when <code>z == d</code> which will happen for sure when <code>j == n</code>. Thus replace</p>

<pre><code>for (i = 0; i &lt;= z/*NUMDIGITS*/; i++)
</code></pre>

<p>by</p>

<pre><code>for (i = 0; i &lt; z/*NUMDIGITS*/; i++)
</code></pre>

<p>Then we just print out the digits</p>

<pre><code>for( i = d -1; i &gt;= 0; i--)
    cout &lt;&lt; (int)a[i];
cout&lt;&lt;"\n";
</code></pre>

<p>and free the allocated memory</p>

<pre><code>delete []a;
</code></pre>
