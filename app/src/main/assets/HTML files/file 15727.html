<p>As far as I know Crystal Reports can access stored procedures instead of sql statments. So put your code for creating the sql statement in a stored procedure and use that as the source of data for the report. </p>

<p>You might have to determine a maximum number of columns to support and always return that number of columns in order to make crystal happy.</p>
