<p>You need to use a closure so that the <code>openRoom</code> variable is exposed to the inner functions.</p>

<p>For example:</p>

<pre><code>(function() {

var openRoom = Math.floor(Math.random() * 90000) + 10000;

io.sockets.on('connection', function (socket) {

    socket.on('addPlayer', function(username) {

        if (io.sockets.clients(openRoom).length &lt;= 2)  {
            socket.join(openRoom);
        } else {
            openRoom = Math.floor(Math.random() * 90000) + 10000;
            socket.join(openRoom);
        }
...

})();
</code></pre>

<p>You could also create a global object with which to store any of your globals in:</p>

<pre><code>if (typeof window['MyApp'] == 'undefined') {

    MyApp = {
        someVar: someValue
    };

}
</code></pre>

<p>This lets you get/set it later:</p>

<pre><code>var x = MyApp.someVar;
</code></pre>
