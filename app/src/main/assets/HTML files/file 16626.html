<p>The problem is not in ASM, but in your test. Basically the CheckClassAdapter is seeing bytecode before max stack and var values are calculated.</p>

<p>You can change code to something like this:</p>

<pre><code>  ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_MAXS);
  cw.visit...

  byte[] byteArray = cw.toByteArray();
  ClassReader cr = new ClassReader(byteArray);
  cr.accept(new CheckClassAdapter(new ClassWriter(0)), 0);
</code></pre>
