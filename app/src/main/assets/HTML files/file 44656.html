<p>^S... means that your url segment STARTS with S which is true for /S123 and not for a/b/a/S123.</p>

<p>use this regex instead :</p>

<pre><code>^.*S(?:.+/)?(\d+)/?$
</code></pre>
