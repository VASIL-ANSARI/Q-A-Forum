<p>Use insert ignore and a conditional select to achieve this in 2 steps.</p>

<p>INSERT IGNORE INTO users (name) VALUES ("raj");</p>

<p>Conditionally use the last insert id or the existing user id while inserting into messages table.</p>
