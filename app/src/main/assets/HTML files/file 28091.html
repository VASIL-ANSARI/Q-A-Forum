<p>Try to avoid the use of sessions in a Facebook app. Facebook loads your webpage in an iframe, which some browsers (Safari in particular) wont work properly with, due to security restrictions.</p>

<p>Facebook recommends to wait with permissions until they're become necessary. You could   request the permissions on canvas-load. Best usecase would be to wait for the user to do an action which requires their information (for example, clicks a "Signup" button).</p>

<p>For your flow to work, I would suggest this approach.</p>

<p>On the landingpage, use <a href="https://developers.facebook.com/docs/reference/login/signed-request/" rel="nofollow">signed request</a> to tell if the user has liked your page.</p>

<pre><code>$signed = parse_signed_request($_REQUEST['signed_request'], 'YOUR-APP-SECRET');
if ($signed['page']['liked'] == 1) {
    $fan = true;
} else {
    $fan = false;
}

if ($fan)
{
    echo "window.location.href = 'https://apps.facebook.com/xxx/';";
}
else
{
     echo "&lt;p&gt;Please like the page.&lt;/p&gt;";
}
</code></pre>

<p>(<a href="http://jobyj.in/api/check-user-is-fan-of-facebook-page/" rel="nofollow">source</a>)</p>

<p>This will redirect users who has liked your page, to the canvas page. Users who hasn't, will see the message "Please like the page". </p>

<p>You dont need to subscribe to 'edge.create', as a click on the "Like" button, will force a page reload and your code will then do the redirect since the user now likes the page.</p>
