<p>Not sure about <code>EntitySet&lt;T&gt;</code> so will focus on <code>IQueryable&lt;T&gt;</code> and <code>IEnumerable&lt;T&gt;</code>.</p>

<p>To allow the LINQ provider to evaluate the expression trees that <code>IQueryable&lt;T&gt;</code> uses for its expression arguments one needs to ensure the underlying interface is preserved. Otherwise do everything in term of <code>IEnumerable&lt;T&gt;</code> (i.e. if you are OK to pull the whole dataset into local memory and then process it there, rather than in the database, just use LINQ to Objects).</p>

<p>The other option is the <code>AsQueryable</code> extension method (part of <code>Queryable</code> class) which converts a <code>IEnumerable&lt;T&gt;</code> to a <code>IQueryable&lt;T&gt;</code>, and then you can share the rest of the code.</p>

<pre><code>IQueryable&lt;T&gt; SomeSharedQuery(this IQueryable&lt;T&gt; source) {
    return source.(LINQ query operators...);
}
IQueryable&lt;T&gt; SomeSharedQuery(this IEnumerable&lt;T&gt; source) {
    return source.AsQueryable().SomeSharedQuery();
}
</code></pre>

<p>So you have the shared code, with an adapter method.</p>
