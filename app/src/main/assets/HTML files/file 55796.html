<p>You can rewrite your query like this:</p>

<pre><code>SELECT user_ID, 1.0 *  A.B / COUNT(*)
FROM tbl_Message M
CROSS APPLY (
    SELECT COUNT(*)
    FROM tbl_Message
    WHERE group_ID IN (
        SELECT group_ID 
        FROM tbl_GroupUser
        WHERE user_ID = M.user_ID)
    AND user_ID &lt;&gt; M.user_ID) A(B)
GROUP BY user_ID, A.B
ORDER BY user_ID;
</code></pre>

<p>Alternatively, if you want the actual amount overall, it would be <code>1.0 * COUNT(*) / A.B</code> and remove the line <code>AND user_ID &lt;&gt; M.user_ID</code> (this produces 1/3 and 2/3).</p>
