<p>Instead of <code>f.SetValue(global::Umbraco.Core.Constants.Conventions.Media.File, (Stream)file.InputStream);</code> you should just use the HttpPostedFileBase: <code>f.SetValue(global::Umbraco.Core.Constants.Conventions.Media.File, file);</code></p>

<p>Some other notes:</p>

<ul>
<li>Check that the file has a length and is not null: <code>file != null &amp;&amp; file.ContentLength &gt; 0</code></li>
<li>You're not using your <code>mediaFolder</code> variable anywhere, can be removed.</li>
<li>Not sure why you'd need <code>global::Umbraco.Core</code>, consider adding <code>using Umbraco.Core;</code> and use <code>Constants.Conventions.MediaTypes.Image</code> etc.</li>
<li>Check that you really need to rely on <code>DisallowedUploadFiles</code> - I'm pretty sure that's checked during <code>CreateMedia</code></li>
</ul>
