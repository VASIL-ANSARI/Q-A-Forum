<p>You need a 2d array if you want to use transpose. Currently you are just printing it out one line at a time. Use map for this:</p>

<pre><code>tbl_array = doc.xpath('//table//tr').map do |row|
  row.xpath('td').map do |cell|
    "\" #{cell_text.gsub("\n", ' ').gsub('"', '\"').gsub(/(\s){2,}/m, '\1')} \", "
  end
end

tbl_array.transpose.each do |row|
  row.each { |cell| print cell }
end
</code></pre>
