<pre><code>namespace( 'com.myapp.service'

  SessionService:

    class SessionService

      # Specify expected constructor services
      @$inject  : ["$rootScope", "$log", "User" ]

      constructor : (@$rootScope, $log, @User) -&gt;

        $log.debug("Calling constructor of SessionService")
        @currentUser = ""

        @initCurrentUser()

        return this

      loadCurrentUser : () -&gt;
        return serverFunctions().func('sessionService').loadCurrentUser("async")

      initCurrentUser : () =&gt;
        result = @loadCurrentUser()

        result.then (res) =&gt;
          @$rootScope.$apply =&gt;
            @currentUser = "test"

        result.fail (e) =&gt;
          @$rootScope.$apply =&gt;
            console.error(e)

      # Returns current user
      getCurrentUser: () =&gt;
        return @currentUser
)
</code></pre>
