<p>You can't just write image object to a file. There are functions in GD library for that. So instead of <code>fopen</code> and <code>fwrite</code>, you should use <a href="http://www.php.net/manual/en/function.imagejpeg.php" rel="nofollow"><code>imagejpeg</code></a> with filename in second parameter:</p>

<pre><code>imagejpeg($im, $grayimgpath);
</code></pre>
