<p>Your second example using the subquery is probably the best - you just need to do the subquery and aggregation in two separate phases, like this:</p>

<pre><code>select sum(x.col2) as sum
from (
    select case 
           when col1 in (select letter from letters_table) then col2 
           else 0 
           end as col2
    from YourTableName
) x
</code></pre>

<p>This should work as intended, and make the parser happy.</p>
