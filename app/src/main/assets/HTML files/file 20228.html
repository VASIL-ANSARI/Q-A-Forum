<p>Yes, it can/will fail because 10 request may all receive 99 comments_count from the SQL query, and each time new row will be inserted to regcomments, and then you'll have 109 rows in the table.</p>

<p>One possible solution would be to move the checking logic into the SQL (use stored procedure with locking/mutex).</p>
