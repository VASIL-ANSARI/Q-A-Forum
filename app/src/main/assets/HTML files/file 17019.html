<p>You are passing a pointer to an automatic storage duration variable (function parameter) as a hash table value. When it goes outside of the scope, it's an undefined behavior to access it.</p>

<p>You can either:</p>

<ul>
<li>Allocate storage for <code>sz</code> with <code>malloc</code>/<code>gnew</code> and register an appropriate <code>value_destroy_func</code> at hash table creation.</li>
<li>Take advantage of the fact that <code>size_t</code> value fits in a pointer and cast it to <code>gpointer</code>. Technically this an UB, but should work on most platforms. Probably should not do this unless small object allocation is identified as a bottleneck.</li>
</ul>
