<p>Try:</p>

<pre><code>RewriteEngine On

# to handle directory slash
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteCond %{HTTP_HOST} ^([^.]+)
RewriteCond %{DOCUMENT_ROOT}/%1%{REQUEST_URI} -d
RewriteRule ^(.+[^/])$ /$1/ [L,R=301]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteCond %{HTTP_HOST} ^([^.]+)
RewriteCond %{DOCUMENT_ROOT}/%1 -d
RewriteRule ^(.*)$ /%1/$1 [L]
</code></pre>

<p>The conditions first check that the request isn't already for an existing file or directory, then that the hostname doesn't start with a "www", then it creates a grouping for the subdomain (e.g. <code>folder</code>), then in the first rule, it checks that the request inside the "folder" is a directory and the request doesn't end with a trailing slash. This will redirect the request to include the trailing slash. This is because mod_dir and the DirectorySlash option will redirect requests for directories without a trailing slash, and this will expose your "folder".</p>

<p>The second rule has the same conditions except that it checks only that the subdomain is a folder that exists. Then it internally rewrites the request to that folder.</p>
