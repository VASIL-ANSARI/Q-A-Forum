<p>I'm not sure this is direct reason for the problem. But there are another parameter that the form send to login action.</p>

<p>Beside <code>username</code>, <code>password</code>, also pass following parameters:</p>

<pre><code>'username': username,
'password': password,
'login': 'Login'.
'sid': sid,   # You need to parse the login page to get sid
'redirect': 'index.php',
</code></pre>
