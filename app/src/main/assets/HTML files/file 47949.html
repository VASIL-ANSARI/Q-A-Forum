<p>Your macros are fine. Here's a test program:</p>

<pre><code>#include &lt;stdio.h&gt;

#define str(x) #x
#define strname(name) str(name)

int main()
{
   printf("\"%s/file\"\n",strname(COMPILETIME));
   return 0;
}
</code></pre>

<p>Build command:</p>

<pre><code>cc -Wall -o soc soc.c
</code></pre>

<p>Output:</p>

<pre><code>"COMPILETIME/file"
</code></pre>

<p>Build command:</p>

<pre><code>cc -Wall -o soc soc.c -DCOMPILETIME=abcd
</code></pre>

<p>Output:</p>

<pre><code>"abcd/file"
</code></pre>

<p>Tested under gcc 4.9.2.</p>

<p>The problem you are facing with <code>fopen</code> could be related to:</p>

<pre><code>sprintf(filepath,"\"%s\file\"",strname(COMPILETIME));
                      ^^^^
</code></pre>

<p>Make that</p>

<pre><code>sprintf(filepath,"\"%s\\file\"",strname(COMPILETIME));
                      ^^^^
</code></pre>

<p>Otherwise, you are escaping the character <code>f</code>, which does nothing. You should also be able to use a forward slash instead of a backward slash.</p>

<pre><code>sprintf(filepath,"\"%s/file\"",strname(COMPILETIME));
                      ^^^^
</code></pre>
