<p>You need to use a more structured data object to take into consideration the optgroup nesting when building your canonical "opts" list. For example, with your HTML snippet, opts might look like:</p>

<pre><code>[{'label': 'Group A', opts: ['Apple',...]}, {'label': 'Group B', opts: [...]}, ..]
</code></pre>

<p>A loop to build this might look like:</p>

<pre><code>var optList = [];
jQuery('#list optgroup').each(function() {
    var $group = $(this),
        optgroup = {'label': $group.attr('label'), opts: []};

    $group.find('option').each(function() {
        optgroup.opts.push(this.innerText);
    });

    optList.push(optgroup);
});
</code></pre>

<p>Then you just iterate through your new data comparing the internal "opts" array values to the input value... of course, building your new optgroup/option markup for any matches you find.</p>

<p>To reset the entire innerHTML of the list and replace it when the list is cleared:</p>

<pre><code>var optionHTML = $("#list")[0].innerHTML;
</code></pre>

<p>then to reset the list:</p>

<pre><code>$("#list").html(optionHTML);
</code></pre>
