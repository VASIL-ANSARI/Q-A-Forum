<p>One possible way is   </p>

<pre><code>Select MessageCorrelationId,BridgeName,ServiceName,OriginSystemName,CreatedDate,ErrorFlag,ErrorMessage
from (
   select *, 
     COUNT(*) OVER (PARTITION BY MessageCorrelationId) as CountSteps,
     ROW_NUMBER() OVER (PARTITION BY MessageCorrelationId ORDER BY CreatedDate DESC) AS rn
   from Activity 
   where OriginatingEventName=@OriginatingEventName 
        AND CreatedDate &gt;= @StartDate  and ErrorFlag=0 
) t
where CountSteps &gt;= @StepCount and rn=1;
</code></pre>
