<p><a href="http://chat.stackoverflow.com/rooms/11/conversation/bug-fix-discussion-between-sean-and-chris-beckett">After the discussion in the Stack Overflow PHP Chat</a>, the problems identified were the following:</p>

<ol>
<li>The <code>$ignore</code> array was structured strangely, if a pupil had multiple meetings it would create multiple top-level arrays, when it should have just used one which referenced that particular pupil.</li>
<li>The  <code>in_array_r</code> function was structured incorrectly.</li>
</ol>

<p>The end fixes resulted in the following changes:</p>

<h3>For #1:</h3>

<p>Additions to the <code>$ignore</code> array were changed to:</p>

<pre><code>$ignore[$item["pupil_id"]][] = array("meeting_id" =&gt; $item2["meeting_id"], "endTime" =&gt; $item2["endTime"]);
</code></pre>

<p>With an additional check to ensure <code>$ignore[$item["public_id"]]</code> is an array, and if it wasn't then to create it before appending a new item to it.</p>

<h3>For #2:</h3>

<p>The <code>in_array_r</code> function was changed to reflect the new array structure:</p>

<pre><code>function in_array_r($array, $key, $val) {
    if(array_key_exists($key, $array)){
        foreach ($array[$key] as $item) {
            if ($item["meeting_id"] === $val)
                return true;
            else
                return false;
        }
    }
}
</code></pre>
