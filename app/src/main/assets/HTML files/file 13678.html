<p>There are many problems in that code, but, sticking to the problem on the question title I think that this line looks suspicious:</p>

<pre><code>string NTLogin = Page.User.Identity.Name.ToString().Split(new char[] { '\\' })[1].ToUpper();  
</code></pre>

<p>what happen if the Page.User.Identity.Name doesn't contain a DOMAIN\USERNAME?</p>

<p>Could be rewritten as </p>

<pre><code>string[] nameparts = Page.User.Identity.Name.ToString().Split(new char[] { '\\' });
string NTLogin = (nameparts.Length == 2 ? nameparts[1] : nameparts[0]).ToUpper();
if(NTLogin.Length == 0)
    return;            
</code></pre>

<p>Why this property could be the error? <a href="http://forums.asp.net/t/1272477.aspx" rel="nofollow">Look at this article</a></p>
