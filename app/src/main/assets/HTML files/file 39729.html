<p>18 is not an error here. Note it is a positive number, while all the error codes are converted to negative numbers in Linux kernel.</p>

<p>Here, 18 is the return value of usb_control_msg(), which returns the length of the device descriptor if success. So it's the bLength field in your device descriptor, which is 18.</p>

<p>The problem lies in the bMaxPacketSize0 field. I don't know what ENDP0_SIZE is, but usb core only accepts following values: 8, 16, 32, 64, 255. If it does not match, the usb_control_msg() is considered failure and report error.</p>

<p>Check hub_port_init() in drivers/usb/core/hub.c. The code flow should be clear.</p>
