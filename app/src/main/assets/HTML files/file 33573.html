<p>Psuedo-code answer:</p>

<pre><code>while ($candies_needed &gt; 0 &amp;&amp; $row = fetch) {
    if ($candies_needed &gt;= $row['candies_available']) {
        $candies_needed -= $row['candies_available'];
        DELETE this row from inventory table;
    } else {
        UPDATE this row in inventory table SET candies_available = candies_available - $candies_needed;
        $candies_needed = 0;
    }
}
if ($candies_needed &gt; 0) { // Haven't fullfilled the entire order
    INSERT $candies_needed into order table;
}
</code></pre>
