<p>This is just a partial response explaining the <code>build_db_file</code> call</p>

<p>As you suspected, the <code>build_db_file</code> call executes a method <a href="http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#M001835" rel="nofollow">generated by creating a <code>belongs_to</code> association</a>. The association is created here:</p>

<pre><code>def self.included(base) #:nodoc:
   Object.const_set(:DbFile, Class.new(ActiveRecord::Base)) unless Object.const_defined?(:DbFile)
   base.belongs_to  :db_file, :class_name =&gt; '::DbFile', :foreign_key =&gt; 'db_file_id'
end
</code></pre>

<p>So the <code>(db_file || build_db_file)</code> statement takes an existing associated <code>DbFile</code> object, or creates a new one if it's nil, and assigns the temp_data to its binary field <code>data</code>. The <code>temp_data</code> is probably the byte array with the data from the form.</p>

<p>And I have one question (I can't comment on your question) - why don't you call <code>db_file.save!</code> after creating it with</p>

<pre><code>db_file = DbFile.new :data =&gt; temp_data
</code></pre>

<p>?</p>
