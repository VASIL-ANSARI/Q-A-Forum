<p>I think you will need to do two separate queries here. That is just too conditional for MongoDB query parser to handle.</p>

<p>So you will need to put your logic into two separate queries with the second looking like:</p>

<pre><code>$db-&gt;akis-&gt;update(
array("h" =&gt; (string) $_SESSION["_id"], "m" =&gt; array('$exists' =&gt; true)),
array('$set' =&gt; array("i" =&gt; $name)),
array("multiple" =&gt; true)
);
</code></pre>

<p>Running one after the other.</p>
