<p>One optimization would be to exclude the item itself from the self-join:</p>

<pre><code>inner join test as t2 
     on t2.feature = t1.feature and t2.id &lt;&gt; t1.id
                                    ^^^^^^^^^^^^^^
</code></pre>

<p>For further speedup, create a covering index on <code>(feature, id, count)</code>.</p>
