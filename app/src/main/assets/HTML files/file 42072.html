<p>phpseclib doesn't - nor can it - verify a hosts authenticity.</p>

<p>What phpseclib does is it lets you retrieve the server public host key via <code>$ssh-&gt;getServerPublicHostKey()</code>. You can do so before you log into the server and you can save the key somewhere, be it in the DB or on the filesystem, and check against that saved key on future connections. </p>

<p>I mean, where would phpseclib save the server public host key anyway? It doesn't know if you have DB access. It doesn't know if any of the filesystem is writable. I suppose it could make use of tempnam() but then, like you said, what does it do on initial connections? Assume you're running it via a web browser (and not the CLI) and present a js popup? And tempnam() isn't permanent anyway. Is it supposed to re-prompt you every time /tmp gets deleted by the filesystem?</p>
