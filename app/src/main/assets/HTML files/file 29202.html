<p>You class <code>MyClient</code> suggests that it is a facade. To test a facade in the context of UnitTests it is normally first of all necessary to test all units that are collaborators of that facade.</p>

<p>As you normally mock the collaborators - and not the unit under test - your test setup looks wrong as you're mocking the <code>MyClient</code> unit under test but not it's collaborators.</p>

<p>For example:</p>

<p>You want to test if the <code>MyClient::parseResponse()</code> method returns the expected <code>ResponseValues</code> object. Therefore you would mock the <code>Response</code> as it is a collaborator in this case.</p>

<p>You probably also want to mock the other collaborator (<code>ResponseValues</code>) however you can't as it is a hidden dependency that can not be injected (you could resolve this by injecting a factory to <code>MyClient</code> that can control the creation of such <code>ResponseValues</code>).</p>

<p>So much for testing <code>MyClient::parseResponse()</code>: You would inject the fixture XML via a <code>Response</code> mock and the run your assertions on the return value.</p>

<p>For the case to test if the request contains valid XML (<code>testRequestContainsValidXml()</code>), I don't think it should be done in that complicated form either. Sounds like you have a HTTP client here, you should only test that it works and don't care if it works with XML as well, because if it works, it works with XML as well. The reason why you test for valid XML is not because you want to test the client. So keep that test out of the client unit-tests.</p>

<p>The assertion for the string stuff btw. is:</p>

<pre><code>$this-&gt;assertSame($expected, $actual);
</code></pre>

<p>Phpunit will show you a nice diff between the strings. Some other programmers / testers were also applying some XML normalization when they compared XML so that the diff is more readable. You might find a Q&amp;A like <a href="http://stackoverflow.com/a/8615485/367456"><em>PHP XML how to output nice format</em></a> and related useful for that if your XML has no problem to deal with insignificant whitespace.</p>

<p>I hope I could pin-point the problem cases you face with this a little and broaden your view on the problem. I think you come most far with questioning your current mock usage critically, for the examples I give I have fully reduced mocking to providing collaborators, not to do assertions. Asswertions are only done on the unit under test, here the exemplary <code>MyClient</code>.</p>
