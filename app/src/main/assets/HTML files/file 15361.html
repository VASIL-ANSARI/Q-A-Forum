<p>The code you've given looks OK - with one caveat: the initial value of <code>counter</code> is not in the code itself. So either you don't start at <code>counter = 0</code>, or some other piece of code is stomping on your <code>indices</code> buffer.</p>

<p>That's the beauty of heap corruptions. There is no guarantee that the bug is in the removed portion on the code. It may simply hide the bug that exists somewhere else in your code.</p>
