<p>As other people have commented your Ruby has syntax errors. You must have valid Ruby and only makes errors in the JSON if I understand your problem correctly.</p>

<p>Specifically you seem to be telling Ruby to create a Hash then convert it to a String which contain texts that happens to comply with the JSON spec. Just make that text directly, then you can control how closely it conforms.</p>

<pre><code>if bad_json
  credentials = "{\"username\":\"#{username}\" \"password\":\"#{password}\"}"
else
  credentials = "{\"username\":\"#{username}\",\"password\":\"#{password}\"}"
end
</code></pre>

<p><strong>EDIT</strong> - More details</p>

<p>To make this point more clear here is a simplified example in irb/pry:</p>

<pre><code>[1] pry(main)&gt; {}.class
=&gt; Hash
[2] pry(main)&gt; {}.to_json
=&gt; "{}"
[3] pry(main)&gt; {}.to_json.class
=&gt; String
[4] pry(main)&gt; "{}".class
=&gt; String
</code></pre>

<p>Here we can see that to_json simply returns a string. So if you can craft a string on your own that is conformant JSON it would be just as good as a string made a JSON processor.</p>
