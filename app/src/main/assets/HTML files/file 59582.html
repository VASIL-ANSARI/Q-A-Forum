<p>First problem to solve is getting the order number from the post_title so that you can compare the values in your inner join. A primitive way of doing this, assuming the order number is always in form AA-DDDD-DDD would be</p>

<pre><code>SELECT right(post_title, 11) as posts_order_number
</code></pre>

<p>As you've already discovered, an inner join is what you need, as it'll only return results where the tables match. Note you usually join tables based on their columns, rather than directly comparing to your '$user_id' string (and you've already filtered for this in your where clause).</p>

<p>You can join on more than one field at a time, to match on order number as well as user_id.</p>

<p>Your query now becomes:</p>

<pre><code>SELECT * 
  FROM test_related_orders tro
  INNER JOIN wp_posts p 
    ON tro.user_id = p.post_author
    AND tro.order_number = right(p.post_title, 11)
  WHERE tro.user_id = '$user_id' AND order_unlock_time &lt;= '$timestamp'
</code></pre>
