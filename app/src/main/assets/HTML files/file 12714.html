<p>Check out the sources to Taksi on sourceforge. <a href="http://taksi.sourceforge.net/" rel="nofollow">http://taksi.sourceforge.net/</a>
You need 2 things. 
1. A code to compress the frames.
2. A container file format. Like AVI or MPG.</p>

<p>Taksi useses the old VideoForWindows API and AVI not the newer COM API's but it still might work for you.</p>
