<p>The e-mail address is not found in the database and therefor <code>user</code> is nil. You can create a user on the fly with the following code:</p>

<pre><code>def process
  user = User.find_or_create_by(email: @email.from[:email]) do |u|
    # todo: set some other properties on the new user u, e.g. the name
  end

  user.posts.create!(
    subject: @email.subject,
    body: @email.body,      
    attachment: @email.attachments,
    from: @email.from[:email]
  )
end
</code></pre>

<p>See also <a href="http://apidock.com/rails/v4.0.2/ActiveRecord/Relation/find_or_create_by" rel="nofollow">ActiveRecord::Relation::find_or_create_by</a>.</p>
