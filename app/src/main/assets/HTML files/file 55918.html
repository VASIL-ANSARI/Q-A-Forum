<p>Here is your bug:</p>

<pre><code>function clean($str) {
    $str = @trim($str);
    if(get_magic_quotes_gpc()) {
        $str = stripslashes($str);
    }
    return mysqli_real_escape_string($str); # &lt;-- BUG!
}
</code></pre>

<p><a href="http://php.net/mysqli_real_escape_string" rel="nofollow"><code>mysqli_real_escape_string</code></a> expects 2 parameters. Your code is written in procedural style so you have to pass:</p>

<ol>
<li>the mysqli link/resource</li>
<li>the string to escape</li>
</ol>

<p>So this function must be extended this way:</p>

<pre><code>function clean($bd, $str) { //new
    $str = @trim($str);
    if(get_magic_quotes_gpc()) {
        $str = stripslashes($str);
    }
    return mysqli_real_escape_string($bd, $str); //new
}
</code></pre>

<p>In your case mysqli_real_escape_string probably returns <code>NULL</code>, <code>false</code> or an empty string - what causes the error messages.</p>

<hr>

<p><strong>Edit:</strong></p>

<p>You're missing also a param on <code>mysqli_query</code>. You have to pass the link as first param. So the function knowns on what connection it should be executed.</p>

<hr>

<p>Also you should check some of this topics, to make your login more secure:</p>

<ul>
<li><a href="http://stackoverflow.com/questions/60174/how-can-i-prevent-sql-injection-in-php">How can I prevent SQL-injection in PHP?</a></li>
<li><a href="http://php.net/manual/en/faq.passwords.php" rel="nofollow">http://php.net/manual/en/faq.passwords.php</a></li>
</ul>
