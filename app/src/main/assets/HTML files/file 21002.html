<p>To get the most recent date that has not been used:</p>

<pre><code>select user_id, max(date) - 1
from (select ud.*,
             (select max(date) from upload_date ud2 where ud2.user_id = ud.user_id and ud2.date &lt; ud.date
            ) as prevdate
      from upload_date ud
     ) ud
where date(from_unixtime(ud.prevdate)) &lt;&gt;  date(from_unixtime(ud.date)) - 1 or
      ud.prevdate is null
group by user_id
</code></pre>

<p>This query first gets the previous date for any given day using a correlated subquery.  It then converts the time values to dates and selects any row where the previous date has a gap.  The largest of the date minus one is the date you are looking for.</p>

<p>This SQL is untested, so it may have syntax errors.</p>
