<p>Given that the code you provide is fairly agnostic to this problem, it's unclear where you're running into a wall. But to get you started:</p>

<pre><code>case 'update':
if ($cart) {
    $newcart = '';
    foreach ($_POST as $key=&gt;$value) {
        ... //same thing as before
    }
    $newcart .= $shipping_price; //or however you're encoding this. It's unclear.
}
$cart = $newcart;
break;
</code></pre>

<p>And also replace:</p>

<pre><code>$output[] = '&lt;p&gt;Grand total: &lt;strong&gt;$'.$total.'&lt;/strong&gt;&lt;/p&gt;';
</code></pre>

<p>with:</p>

<pre><code>$output[] = '&lt;p&gt;Grand total: &lt;strong&gt;$'.$total+ $shipping_price.'&lt;/strong&gt;&lt;/p&gt;';
</code></pre>
