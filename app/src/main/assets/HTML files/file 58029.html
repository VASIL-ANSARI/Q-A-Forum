<p>Your <code>std::string</code> implementation uses reference counting and makes a deep copy only if you modify the string via its <code>operator[]</code> (or some other method). Casting the <code>const char*</code> return value of <code>c_str()</code> to <code>char*</code> will lead to undefined behavior.</p>

<p>I believe since C++11 <code>std::string</code> must not do reference counting anymore, so switching to C++11 might be enough to make your code work (<strong>Edit:</strong> I did not actually check that before, and it seems my assumption was wrong). </p>

<p>To be on the safe side, consider looking for a string implementation that guarantees deep copying (or implement one yourself).</p>
