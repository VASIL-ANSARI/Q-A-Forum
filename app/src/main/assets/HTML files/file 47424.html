<p>You can do this easily using a correlated subquery:</p>

<pre><code>select o.*,
       (select count(*)
        from orders o2
        where o2.email = o.email and
              o2.order_date &lt; o.order_date and
              o2.order_date &gt;= o.order_date - interval 1 year
       ) as NumOrdersPrevYear
from orders o;
</code></pre>
