<p>I had this same issue this is what I came up with.</p>

<p>This is very important:</p>

<p><strong>karma.conf.js</strong></p>

<pre><code> {
    pattern: 'ROOT/TO/YOUR/angular-ui-router/release/angular-ui-router.js',
    included: false
  },
</code></pre>

<p><strong>test-main.js</strong> : This is your karma - require - config file</p>

<pre><code> paths: {
    // External libraries
    'angular': '/base/PATH/TO/YOUR/angular/angular',
    'angularMocks': '/base/PATH/TO/YOUR/angular-mocks/angular-mocks',
    'uiRouter' : '/base/PATH/TO/YOUR/angular-ui-router/release/angular-ui-router',
.....
</code></pre>

<ul>
<li><strong>/base/</strong> + your path</li>
</ul>

<h2>DO THE SHIMMY</h2>

<pre><code> shim: {
    'angular': { 'exports': 'angular' },
    'angularMocks': { deps: ['angular'], 'exports': 'angular.mock' },
    'uiRouter' : {deps: ['angular'], 'exports' : 'uiRouter'},
</code></pre>

<h3>Now we are inside out test.</h3>

<p>define the module</p>

<pre><code>define([
 'angular',
 'angularMocks',
 'uiRouter',
 .....
</code></pre>

<p>Now when you set up your <strong>beforeEach</strong></p>

<pre><code>BeforeEach(inject(function ($injector){
  $state = $injector.get('$state');
  ....
</code></pre>

<p>Hope this helps you out.</p>
