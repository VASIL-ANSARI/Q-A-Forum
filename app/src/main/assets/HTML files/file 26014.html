<p>First of all, I believe this is a really bad idea to write doctests like this. Since it requires a lot of initialization work, which is going to be included in documentation (remember doctests) and will not "document" anything. And, to me, these tests seems to be the job for unit/integration test. But if you really want, here's a way to do it:</p>

<pre><code>import myapp
from pyramid.paster import get_appsettings
from webtest import TestApp
app, conf = myapp.init(get_appsettings('settings.ini#appsection'))
rend = conf.testing_add_renderer('template.pt')
test_app = TestApp(app)
resp = test_app.get('/my/view/url')
rend.assert_(key='val')
</code></pre>

<p>where <code>myapp.init</code> is a function that does the same work as your application initialization function, which is called by <code>pserve</code> (like <code>main</code> function <a href="http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/startup.html" rel="nofollow">here</a>. Except <code>myapp.init</code> takes 1 argument, which is settings dictionary (instead of <code>main(global_config, **settings)</code>). And returns app (i.e. <code>conf.make_wsgi_app()</code>) and <code>conf</code> (i.e <code>pyramid.config.Configurator</code> instance). <code>rend</code> is a <a href="http://docs.pylonsproject.org/projects/pyramid/en/latest/api/testing.html#pyramid.testing.DummyTemplateRenderer" rel="nofollow"><code>pyramid.testing.DummyTemplateRenderer</code></a> instance.</p>

<p>P.S. Sorry for my English, I hope you'll be able to understand my answer.</p>

<p>UPD. Forgot to mention that <code>rend</code> has <code>_received</code> property, which is the value passed to renderer, though I would not recommend to use it, since it is not in public interface.</p>
