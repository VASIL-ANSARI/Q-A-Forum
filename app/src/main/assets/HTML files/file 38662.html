<p>Such algorithms are never perfect: you can never know exactly if two people know each other. People might live in the same building, go to the same work, have 100 friends in common and even share the same hobbies without knowing each other (of course the odds are not that great).</p>

<p>What Social networks do exactly is of course unknown (that's part of the way they make money). But some aspects are known. For instance the number of mutual friends are important (together with for instance location, interests, hobbies, education, work, surname,...).</p>

<p>Based on what you provide, one can more or less only use the number of mutual friends. This can be done using the following query:</p>

<pre><code>SELECT a.user_id, b.user_id2, count(*) --Select the two ids and count the number of transitive relations
FROM connections as a, connections as b --Use the table twice (transitivity)
WHERE a.user_id2 = b.user_id  -- Transitivity constraint
      AND a.user_id &lt; b.user_id2 -- Maintain strict ordening (can be dropped when checked)
      AND a.status = 1 -- First relation must be confirmed.
      AND b.status = 1 -- Second connection must be confirmed.
      AND NOT EXISTS ( -- Not yet friends
          SELECT *
          FROM connections as c
          WHERE c.user_id = a.user_id
                AND c.user_id2 = b.user_id2
      )
GROUP BY a.user_id, b.user_id2 -- Make sure we count them correctly.
</code></pre>

<p>As you can see <a href="http://sqlfiddle.com/#!2/da4e981/4/0" rel="nofollow">here</a>, the fiddle calculates that <code>(1,2)</code>, <code>(1,4)</code> and <code>(2,4)</code> are not yet friends, and all have one mutual friend.</p>

<p>Once the number of mutual friends surpasses a certain threshold, one can propose friendship.</p>

<p>I would however advice you to make your table more compact: add a <code>CHECK</code> to the table such that <code>user_id</code> is always strictly less than <code>user_id2</code> (<code>CHECK(user_id &lt; user_id2)</code>). This makes the database more compact, for most implementations of a database tool faster as well and queries will become simpler. What is after all the difference between <code>(1,3,1)</code> and <code>(3,1,1)</code>.</p>
