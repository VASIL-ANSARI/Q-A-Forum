<pre><code>&lt;?php

$input = file("./file1", FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
$filter = file("./file2", FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
$new_line = "\n";  // \r\n
$result = "";

function pass_filter($line, $filter) {
    $i = count($filter);
    $res = false;
    while (--$i &gt; -1 ) {
        if (strrpos($line, $filter[$i]) &gt; 0) {
            $res = true;
            break;
        }
    }
    return $res;
}



for ($j = 0; $j &lt; count($input); $j++) {

    if ( pass_filter($input[$j], $filter) ) {
        $result .= $input[$j] . $new_line . $input[($j+1)] . $new_line;
    }
    $j++;
}

file_put_contents("./file3",$result);

?&gt;
</code></pre>
