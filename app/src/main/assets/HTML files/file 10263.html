<p>you could use <code>AsyncCallback</code> instead of <code>Sleep()</code></p>

<pre><code>AsyncCallback callback = new AsyncCallback(HandleCallback);
sqlcommand.BeginExecuteNonQuery(callback, sqlcommand);
</code></pre>

<p>handles the Async state using callback.</p>

<pre><code>private void HandleCallback(IAsyncResult result)
{
  SqlCommand command = (SqlCommand)result.AsyncState;
  command.EndExecuteNonQuery(result);
  ....
}
</code></pre>

<p><strong>UPDATE 2</strong></p>

<p>the codes overall are good however , are you allowed multiples files download in one unique id ? if you are downloading different files with same unique Id It could update the downloads table which reporting incomplete progress.</p>

<p>Not sure what you mean <code>DownloadCompleted</code> only work in debug mode however you could use a private variable in your WebMethod to control flow. Speaking with that, since you are using DB to reporting status changed but not inserting large amount of data you should consider using sync queries so that it could better archive the result.</p>
