<p>Dynamically mapping form input to SQL columns in the way intended here is a terrible idea from a security standpoint. Anyone will be able to dump any data into any column by constructing a matching POST request.</p>

<p>Furthermore, by interpolating form values directly into your SQL string you are vulnerable to SQL injection. Anyone can submit a fake POST request and execute arbitrary SQL that will expose or damage any table in your database.</p>

<p>With that warning being given, what you want is to iterate over the keys in the first record using PHP's <code>foreach</code></p>

<p><a href="http://www.php.net/manual/en/control-structures.foreach.php" rel="nofollow">http://www.php.net/manual/en/control-structures.foreach.php</a></p>

<pre><code>foreach ($main_record as $column_name =&gt; $column_value) {
   ...
}
</code></pre>

<p>Inside the loop, you will have to build up two strings in each iteration. The first one contains the column names (the comma seperated list after the table name). The second one contains the values.</p>

<p>After that, you will have to get the ID of the last inserted record, PDO has a function for that. Then you'll have to repeat this technique for each of the associated records.</p>

<p>If you want a better solution, consider using a framework like Laravel, which includes an Object-Relational Mapper library called Eloquent ORM. It will make these kind of operations simpler and safer to program.</p>
