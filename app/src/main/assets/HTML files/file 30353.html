<p>Can you disable these three lines and check again if this bug occures?  </p>

<pre><code>if (!$user instanceof SsoUser &amp;&amp; !$this-&gt;supportsClass(get_class($user))) {
            throw new UnsupportedUserException(sprintf('Instances of "%s" are not supported.', get_class($user)));
        }
</code></pre>

<p>I feel that there might be a problem with <code>$user</code> type or <code>!$this-&gt;supportsClas</code> &lt;- should there be a '!' sign?</p>
