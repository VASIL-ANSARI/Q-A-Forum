<p>Most probably <code>CImage</code> is local and going out of scope, thus the image (and <code>HBITMAP</code>) is invalid. You have two options:</p>

<ul>
<li>Declare <code>CImage</code> such that it would exist even after this function returns.</li>
<li>Use <code>CImage::Detach</code> which returns a <code>HBITMAP</code> and relinquishes its ownership with handle (i.e. won't delete on destructor).</li>
</ul>

<p>Please ensure that given image exists and is loaded properly.</p>

<p>Also, you don't need to <code>new CClientDC</code>, you can have it on stack.</p>
