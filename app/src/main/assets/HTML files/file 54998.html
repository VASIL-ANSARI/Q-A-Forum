<pre><code>select b.id, 
sum(case when h.type &lt;&gt; 10 and h.time between '2016-06-01' and '2016-06-31' then h.points 
    else 0 end) as points
from brands b 
left join histories h on b.id = h.brandid and h.userId = $userId
and b.active=1 and b.id=$brandId
group by b.id
</code></pre>
