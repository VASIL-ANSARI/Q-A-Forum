<p>Your "load" handler for your <code>FileReader</code> is declared without an <code>event</code> parameter. As a result, it's not going to have access to the file contents.</p>

<pre><code>        fileReader.onload = function (event) {
           var ab = event.target.result;
</code></pre>

<p>Without that parameter, the symbol "event" would refer to the parameter of the enclosing function, and that one won't have the file contents.</p>

<p>Also, I think you don't need to do the base64 encoding/decoding via <code>atob</code> and <code>btoa</code>, because the results of converting the canvas contents to a data URL will be a  base64 string anyway.</p>
