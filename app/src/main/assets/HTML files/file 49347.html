<pre><code>select A.Category,sum(B.SP) as TotalSP,sum(B.CP) as TotalCP,
case
when TotalSP&gt;TotalCP then ((TotalSP-TotalCP)/TotalSP)*100  
when TotalSP&lt;TotalCP then ((TotalSP-TotalCP)/TotalCP)*100
end
as TotalProfit
from Catalog A
INNER JOIN Stock B ON B.catalog_id = A.id/*Write how your tables linked here*/
group by A.Category;
</code></pre>

<p>This query selects all catalog records, joins stock data to it, then groups results by category, counts sums in each group.  </p>
