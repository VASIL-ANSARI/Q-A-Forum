<p>WS-Security standard defines the password digest as Base64 ( SHA-1 ( nonce + created + password ) ). </p>

<p>You reflect this correctly by hashing the content of <em>beforeEncryption</em> variable and store the result to <em>encryptedRaw</em> and then base64-encode it to <em>encoded</em> variable. So far so good. But the <em>encoded</em> variable is not used anywhere. For some reason, you compute a second digest base64(sha1("password")) and store it to <em>senha</em> variable that is used later to fill the WSS Password element.</p>

<p>Completely remove the code that computes the second digest and use the content of the encoded variable:</p>

<p>Conceptually, change the pwd.setValue() from: </p>

<pre><code>pwdE.setValue(senha)
</code></pre>

<p>To: </p>

<pre><code>pwdE.setValue(encoded)
</code></pre>

<p>and make sure that <em>encoded</em> variable will be a String, not a byte array. </p>

<p>Additionally, you should consider to use a better value for <em>nonce</em> than an object hash-code. </p>
