<p><a href="http://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/DatabaseStatements.html#method-i-execute" rel="nofollow"><code>conn.execute(sql)</code></a> does not accept a block, it simply returns a result. The proc afterwards is treated by a ruby interpreter as âorphan proc definitionâ and never gets executed. You might try to put <code>puts 'I am here'</code> inside it and see it is never called.</p>

<p>The solution would be to <em>iterate</em> the result:</p>

<pre><code>get '/all_users/' do
  conn = TinyTds::Client.new(...)
  sql = 'select * from dbo.ServerUsers'

  #                           ââââââââââââââââ iterate!!!
  records = conn.execute(sql).each_with_object([]) do |record, memo|
    client = AndroidtableClientsSearch.new(*5.times.map { |i| record[i] })
    memo &lt;&lt; client.to_s
  end

  require 'json'
  JSON.dump(clientList: records)
end
</code></pre>
