<p>Build an array of the data first, and then loop through them to build the HTML. </p>

<pre><code>$dataarray = array();
while($row = $result-&gt;fetch_assoc())
{
    $year = date('Y', strtotime($row['uploaddate']));
    $month = date('F', strtotime($row['uploaddate']);

    $dataarray[$year][$month][] = $row['filename'];
}

foreach($dataarray as $year =&gt; $months)
{
    echo '&lt;ul&gt;'; //etc.....

    foreach($months as $monthname =&gt; $filenames)
    {
        //put one more loop for the filenames in here
    }
}
</code></pre>

<p>Note: The code can be improved a bit, I just did it quickly.</p>

<p>Note: This is very "arrow" like in nature, so you might want to find ways to optimize once you get it working.</p>
