<p>What you are facing here is a balancing problem. You can use recursion to solve it, my approach would be:</p>

<pre><code>^\d*(\d)(?:(\d(?:(\s*;\s*\d*\1)|\g&lt;2&gt;)\d)|\g&lt;3&gt;)$
</code></pre>

<p>This will take <code>\s*;\s*\d*\1</code> as the content between two balanced groups of numbers. To get out of the recursion, this content has to be matched exactly once (to avoid matches like <code>122</code> or <code>12;1;13</code>). The recursion to this content as an alternation is for the case of the doubled digit being the last of each number.</p>

<p>You can find some test cases <a href="http://rubular.com/r/zFITnoF5qM" rel="nofollow">here</a></p>
