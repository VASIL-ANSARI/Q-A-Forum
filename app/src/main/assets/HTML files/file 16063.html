<p>The problem is that Net::SSH uses a different shell for each exec call.  The solution is to use stateful shell.  There is a gem to do this, but it is outdated.  Net::SSH::Shell via <a href="https://github.com/mitchellh/net-ssh-shell" rel="nofollow">https://github.com/mitchellh/net-ssh-shell</a> </p>

<p>I chose to use Rye to handle this task. <a href="http://code.google.com/p/rye/" rel="nofollow">http://code.google.com/p/rye/</a></p>
