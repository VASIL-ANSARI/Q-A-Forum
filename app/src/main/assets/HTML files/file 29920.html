<p>Just use a CTE or subquery to create the ages first, and then a simple group by query to tally them up:</p>

<pre><code>; With Ages as (
    Select
        DateDiff(YEAR, dob, CURRENT_TIMESTAMP) - 
        CASE WHEN
            DATEADD(year,DateDiff(YEAR, dob, CURRENT_TIMESTAMP),CURRENT_TIMESTAMP)
            &gt; CURRENT_TIMESTAMP
        THEN 1
        ELSE 0 END as ageYears

    from [database].[dbo].[users]
)
SELECT ageYears,COUNT(*) as NumUsers
FROM Ages
GROUP BY ageYears
</code></pre>

<p>The alternative, that doesn't need the subquery or CTE is to repeat the entire complex expression in the GROUP BY clause:</p>

<pre><code>Select
    DateDiff(YEAR, dob, CURRENT_TIMESTAMP) - 
    CASE WHEN
        DATEADD(year,DateDiff(YEAR, dob, CURRENT_TIMESTAMP),CURRENT_TIMESTAMP)
        &gt; CURRENT_TIMESTAMP
    THEN 1
    ELSE 0 END as ageYears,
    COUNT(*) as numUsers
from [database].[dbo].[users]
group by
DateDiff(YEAR, dob, CURRENT_TIMESTAMP) - 
    CASE WHEN
        DATEADD(year,DateDiff(YEAR, dob, CURRENT_TIMESTAMP),CURRENT_TIMESTAMP)
        &gt; CURRENT_TIMESTAMP
    THEN 1
    ELSE 0 END as ageYears
</code></pre>

<p>Personally, I prefer the former version.</p>
