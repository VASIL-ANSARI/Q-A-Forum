<p>Here's mine:</p>

<pre><code>data.scan(/(MATCH ME)(.*?)\n\n((?:(?!\n\n).)*)/m).each do |m, n, lines|
  lines.each_line do |line|
    puts [m, n, *line.unpack('A9A10A*')].map(&amp;:strip).join(',')
  end  
end
</code></pre>

<p>That regex is ugly, but still better than looking at 30 lines.
(?:(?!\n\n).)* means match any char that is not followed by 2 newlines. the (?:) is so it doesn't also capture the '.'</p>
