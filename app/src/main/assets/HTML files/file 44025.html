<p>Try to remove if (!ajax.responseText)</p>

<pre><code>ajax.onreadystatechange = function () {
    if (ajax.readyState &gt;= 4 &amp;&amp; ajax.status == 200) {
        canPost = 1;
        posted = 0;
    }
}
</code></pre>

<p>Do you need the "posted" variable?  Looks like this isn't used by the code anymore.  The purpose of canPost seems to me to avoid to requests at the same time.  Is it really a point to avoid that here?</p>
