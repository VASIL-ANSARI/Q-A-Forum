<p>Your error check is incorrect.  <code>send()</code> returns the number of bytes sent or -1 on error.  You check only that the return value equals <code>packetSize</code>, <em>not</em> that the return value indicates error.  <a href="http://stackoverflow.com/questions/2618736">Sometimes <code>send()</code> on a stream socket will return fewer bytes than requested</a>.</p>

<p>So, some previous syscall (perhaps a harmlessly failed tty manipulation?  a dodgy signal handler?) set <code>errno</code> to EIO.</p>

<p>Change your code to treat -1 different from a "short" send.</p>
