<p>You've asked two questions.  I will answer your second question, "how to get the local path the user has been redirected from to the custom error page?"</p>

<p>It depends on how you are directing the user to the error page.  If you direct the user to the custom error page by handling uncaught exceptions in global.asax, you can write something like this:</p>

<pre><code>protected void Application_Error(object sender, EventArgs e)
{
    string url = System.Web.HttpContext.Current.Request.Url.ToString();
    Exception ex = Context.Server.GetLastError();
    // do something with url and exception data
}
</code></pre>

<p>If you are manually redirecting the user to the error page, say with <code>Response.Redirect</code>, there are several ways you may accomplish this.</p>

<p>Normally, web browsers will send to the web server the address of the page they just came from, but some users (and some firewalls) will disable this functionality.  When the data is available, you can normally get it by calling <code>Request.ServerVariables["HTTP_REFERER"];</code>.</p>

<p>However, if you want to be sure you get the data, consider saving the URL of the page where the error occurs just before redirecting the user to the error page like this:</p>

<pre><code>if (error_condition) 
{
    Session["error_url"] = System.Web.HttpContext.Current.Request.Url.ToString();
    Response.Redirect(error_page);
}
</code></pre>
