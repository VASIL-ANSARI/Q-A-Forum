<p>Calling string.replace returns the new string with the replaced text, without modifying the original string itself.</p>

<p>So your code:</p>

<pre><code>replaced = haystackText.replace(...)
</code></pre>

<p>is setting the updated text into the variable "replaced", but never updating the variable "haystackText".</p>

<p>Additionally, since you do this:</p>

<pre><code>if (haystackText.length == 0) {
      haystackText = document.getElementById("haystack").innerHTML;
 }
</code></pre>

<p>It will only set the haystackText the first time the method is called, but not the second. It doesn't look like you have a need for leaving haystackText as a global variable (outside of the method), so changing this:</p>

<pre><code> if (haystackText.length == 0) {
      haystackText = document.getElementById("haystack").innerHTML;
 }
</code></pre>

<p>to this:</p>

<pre><code>var haystackText = document.getElementById("haystack").innerHTML;
</code></pre>

<p>would fix your problem.</p>
