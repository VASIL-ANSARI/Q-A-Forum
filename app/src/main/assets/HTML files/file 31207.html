<p>The problem isn't your synchronization, it's your file accesses. You read from the file, seek back to the beginning, and then write to the file. Where do you think the next read is going to come from?  You need to seek back to the start of the file after every write, as well.</p>

<p>You also have some buffer overflows, because you are using a char as a single-character string.  It doesn't work that way, because you don't have room for the null-terminator.</p>
