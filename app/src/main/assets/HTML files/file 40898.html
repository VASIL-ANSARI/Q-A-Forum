<pre><code>int get_line(FILE *fp, char *buffer, size_t buflen)
{
    char line[4096];
    assert(buflen &gt; 1);
    if (fgets(line, sizeof(line), fp) == 0)
        return EOF;
    size_t len = strlen(line);
    if (line[len-1] == '\n')
        line[--len] = '\0';
    if (len &gt;= buflen)
        len = buflen - 1;
    memmove(buffer, line, len);
    buffer[len] = '\0';
    return len;
}

void getinfo(student *details[], int *count, FILE *fp)
{
    student *info;

    while ((info = malloc(sizeof(*info)) != 0)
    {
        if (get_line(fp, info-&gt;name, sizeof(info-&gt;name)) == EOF ||
            get_line(fp, info-&gt;street, sizeof(info-&gt;stree)) == EOF ||
            get_line(fp, info-&gt;citystate, sizeof(info-&gt;citystate)) == EOF ||
            get_line(fp, info-&gt;zip, sizeof(info-&gt;zip)) == EOF)
        {
            free(info);
            return;
        }
        details[(*count)++] = info;
    }
}
</code></pre>
