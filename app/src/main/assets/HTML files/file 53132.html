<p>The page <code>$helper-&gt;getAccessToken()</code> runs on must be the <strong>exact</strong> same URL you provide to <code>$helper-&gt;getLoginUrl()</code>. As you've indicated <code>http://localhost/site/externallogin</code> redirects to <code>http://localhost/site/externallogin/</code> on your webserver, add the <code>/</code> when you make <code>$loginUrl</code>:</p>

<pre><code>$loginUrl = $helper-&gt;getLoginUrl("http://localhost/site/externallogin/", $permissions);
</code></pre>
