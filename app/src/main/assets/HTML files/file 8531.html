<p>Surely you need <code>std::ostream</code> in all locations?  i.e.:</p>

<pre><code>friend std::ostream&amp; operator &lt;&lt;(std::ostream&amp; os, Expression&amp; exp) ...
                                 ^^^
</code></pre>
