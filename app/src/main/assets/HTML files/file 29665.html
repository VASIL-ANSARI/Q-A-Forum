<p>You have lots of problems with your program.</p>

<p>If the .dat file does not exist, then the fopen will fail, leaving the file pointer as NULL.
The subsequent fscanf will also not work, which is why you get 0 for the record count.  The behaviour of feof with a NULL file pointer is undefined, so that's probably where you are hanging.  By all rights, this program should crash.</p>
