<p>Based on your update, the problem is that jQuery was included after jQuery UI. </p>

<p>When jQuery UI initializes, it essentially builds itself into the existing jQuery code. If you include another version of jQuery after that, the original jQuery (with jQuery UI attached!) will be thrown out. Which is why UI-specific methods like datepicker are throwing errors.</p>

<p>Definitely better to only include jQuery once, but including jQuery UI <em>again</em> after the second jQuery instance would (probably) work correctly.</p>

<p>EDIT: The reason it works outside a function is, very likely, that it ran there before the second copy of jQuery had overwritten the first. The function runs later, perhaps?</p>
