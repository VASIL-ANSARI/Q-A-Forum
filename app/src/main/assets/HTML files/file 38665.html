<p>The problem with your first version is that it's breaking from inner loop where it shouldn't. Here's a working version that is almost as fast as a non-working one.</p>

<pre><code>def palindrome2(smaller_than)
  max = 0

  999.downto(143).each do |x|
    999.downto(707).each do |y|
      product = x * y
      break if max &gt; product
      next if smaller_than &lt; product
      max = product if product.to_s == product.to_s.reverse
    end
  end

  return max
end
</code></pre>

<h2>Also,</h2>

<p>You can achieve the same speedup if you just rearrange the conditions in your check, to enable <a href="http://en.wikipedia.org/wiki/Short-circuit_evaluation" rel="nofollow">short-circuiting</a>.</p>

<pre><code>  # max = x * y if (x * y == (x * y).to_s.reverse.to_i) &amp;&amp; (smaller_than &gt; x * y)
  max = x * y if (smaller_than &gt; x * y) &amp;&amp; (x * y == (x * y).to_s.reverse.to_i)
</code></pre>
