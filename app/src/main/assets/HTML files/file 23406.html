<p><strong><a href="http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454">THE PONY HE COMES...</a></strong></p>

<p>Use a parser:</p>

<pre><code>$dom = new DOMDocument();
$dom-&gt;loadHTML($content);
$xpath = new DOMXPath($dom);
$remove = $xpath-&gt;query("//li[.//img[starts-with(@src,'/mapfiles/')]]");
foreach($remove as $r) $r-&gt;parentNode-&gt;removeChild($r);
$output = substr($dom-&gt;saveHTML($dom-&gt;getElementsByTagName('body')-&gt;item(0)),6,-7);
</code></pre>
