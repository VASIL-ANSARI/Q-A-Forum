<p>First, you can't use <code>KDTree</code> and <code>pdist</code> with sparse matrix, you have to convert it to dense (your choice whether it's your option):</p>

<pre><code>&gt;&gt;&gt; X
&lt;2x3 sparse matrix of type '&lt;type 'numpy.float64'&gt;'
        with 4 stored elements in Compressed Sparse Row format&gt;

&gt;&gt;&gt; scipy.spatial.KDTree(X.todense())
&lt;scipy.spatial.kdtree.KDTree object at 0x34d1e10&gt;
&gt;&gt;&gt; scipy.spatial.distance.pdist(X.todense(),'euclidean')
array([ 6.55743852])
</code></pre>

<p>Second, from <a href="http://scikit-learn.org/0.12/modules/neighbors.html" rel="nofollow">the docs</a>:</p>

<blockquote>
  <p>Efficient brute-force neighbors searches can be very competitive for small data samples. However, as the number of samples N grows, the brute-force approach quickly becomes infeasible.</p>
</blockquote>

<p>You might want to try 'ball_tree' algorithm and see if it can handle your data.</p>
