<p>So. I changed <code>max-heapify</code> to return an index to the node that should be eliminated.</p>

<pre><code>int max_heapify(std::deque&lt;int&gt; &amp;A, int i, int heapsize)
{
    int largest;
    int l = left(i);
    int r = right(i);
    if(l &lt;= heapsize &amp;&amp; A[l] &gt; A[i])
        largest = l;
    else
        largest = i;
    if(r &lt;= heapsize &amp;&amp; A[r] &gt; A[largest])
        largest = r;
    if(largest != i) {
        exchange(A, i, largest);
        int j = max_heapify(A, largest, heapsize);
        return j;
    }
    return i;
}
</code></pre>

<p>Then I erased the element in <code>heap_extract_max</code></p>

<pre><code>int heap_extract_max(std::deque&lt;int&gt; &amp;A, int heapsize)
{
    if(heapsize &lt; 0)
        throw std::out_of_range("heap underflow");
    int max = A.front();
    A[0] = A[heapsize--];
    int i = max_heapify(A, 0, heapsize);
    A.erase(A.begin() + i);
    return max;
}
</code></pre>

<p>I get this output for 11 elements:</p>

<pre><code>79 10 61 99 28 12 51 96 13 37 83 
99 96 83 79 37 61 51 10 13 28 12 
Extract max -&gt;  99
96 83 61 79 37 12 51 10 13 28 
Extract max -&gt;  96
83 79 61 51 37 12 10 13 28 
</code></pre>

<p>I really thought initially that I'd just be able to pop the last element after its value was recorded into the root and then reorganize the heap, but it wasn't cooperating. So the alternative was to delete the node position after the heap was reorganized.</p>

<p>Going back to the original code:</p>

<p>I realized where the problem was. I need to decrement the heapsize before I index the array using the variable, not after. Then I can just pop the last element the way I intended.</p>

<pre><code>int heap_extract_max(std::deque&lt;int&gt; &amp;A, int heapsize)
{
    if(heapsize &lt; 0)
        throw std::out_of_range("heap underflow");
    int max = A.front();
    A[0] = A[--heapsize];
    A.pop_back();
    max_heapify(A, 0, heapsize);
    //int i = max_heapify(A, 0, heapsize);
    //A.erase(A.begin() + i);
    return max;
}
</code></pre>
