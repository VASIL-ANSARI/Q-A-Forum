<p>I think the following code in CustomEnocdePassword is causing your problem:</p>

<pre><code>if(username.equals(null)){
  throw new IllegalArgumentException("Username cannot be null");
}
</code></pre>

<p>Replace it with</p>

<pre><code>if(username==null)){
  throw new IllegalArgumentException("Username cannot be null");
}
</code></pre>

<p>According to the stack-trace spring encounters a NPE when setting the <code>passwordEncoder</code> property of the <code>DaoAuthenticationProvider</code> bean. If you take a look at the <a href="http://grepcode.com/file/repo1.maven.org/maven2/org.springframework.security/spring-security-core/3.1.4.RELEASE/org/springframework/security/authentication/dao/DaoAuthenticationProvider.java#DaoAuthenticationProvider.setPasswordEncoder%28java.lang.Object%29" rel="nofollow">setter</a> method you'll see that it invokes <code>passwordEncoder.encodePassword(USER_NOT_FOUND_PASSWORD, null);</code>, which causes a null pointer in your current code.</p>

<p>Also note that <code>org.springframework.security.authentication.encoding.PasswordEncoder</code> is now deprecated.</p>
