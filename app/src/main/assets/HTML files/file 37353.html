<p>First, you should stop the recorder before destroying it, but that's not enough. </p>

<p>Since OpenSL callbacks are called from its own thread, stopping the recorder from another thread does not mean immediately all callbacks halt. (Or no new callbacks will be called.) Therefore you have to 'count' how many buffers you enqueued, so in the callback you can count how many callbacks were processed.</p>

<p>So the pseudo code looks something like this:</p>

<ul>
<li>stop the recorder by setting the record state to <code>SL_RECORDSTATE_STOPPED</code>, do not enqueue more buffer queues.</li>
<li>wait till all the enqueued buffer queues were processed by checking your counter(s).</li>
<li>destroy the recorder, and free up other resources (memory) that might be used by your callback. </li>
</ul>

<p>When enqueueing bufferques, and at the end of opensl callbacks you have to count the enqueued / processed buffer queues yourself in a thread safe manner. </p>

<p>You can use pthread mutexes / conditions / broadcasting while waiting for all the processing happen. (Or you may use a simple while loop with some sleeping some inside.)</p>
