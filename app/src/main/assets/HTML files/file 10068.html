<p>You've just dropped your complete code here, so I assume you don't have the faintest idea of where it's failing. Well, that's the most basic troubleshooting technique: isolating the part of the code that doesn't work as expected. In your case, the interesting points are:</p>

<h1>1. SQL queries</h1>

<p>First, while debugging you have to print the SQL code on screen and run it in your favourite MySQL client to make sure that it returns the data you want.</p>

<p>Second, you always have to check the return value of <a href="http://php.net/mysql_query" rel="nofollow">mysql_query()</a> and take actions if they fail (for instance, log the <a href="http://php.net/mysql_error" rel="nofollow">mysql_error()</a> and abort the script).</p>

<h1>2. Variables</h1>

<p>Use <a href="http://php.net/var_dump" rel="nofollow">var_dump()</a> to inspect your variables and make sure they have the information you think they have.</p>

<h1>3. PHPExcel</h1>

<p>Don't even try to create an Excel spreadsheet until you've populated <code>$data</code> successfully.</p>

<hr>

<p><strong>Edit:</strong> If you followed my advice and printed your SQL query:</p>

<pre><code>var_dump(
    "SELECT * FROM mtable WHERE DataVersionDate='$datav' &amp;&amp; Pathogen='$pathogen' &amp;&amp; Topic='$topic1' &amp;&amp; Indicator='$ind1' &amp;&amp; IndicatorSubGroup='$subindg1' &amp;&amp; (Country IN ('$sql_cntys') OR  Location_Who IN ('$sql_cntys')) "
);
</code></pre>

<p>You would already know whether <code>$datav</code> has the right value or not. If the value is not correct, then you know the issue is here:</p>

<pre><code>$datav=$_GET["datav"];
</code></pre>

<p>Otherwise, you can forget about the URL. And so on.</p>
