<pre><code> SELECT a.name
      , b.secret_ingredient 
   FROM 
      ( SELECT r.*
             , MAX(p.created_at) max_created_at 
          FROM restaurants r 
          JOIN awarded_prizes z 
            ON z.id = r.latest_prize_id 
          JOIN pizzas p 
            ON p.created_at &lt;= z.won_at 
         GROUP 
            BY r.id
      ) a 
   JOIN pizzas b 
     ON b.created_at = a.max_created_at;
 +--------------+-------------------+
 | name         | secret_ingredient |
 +--------------+-------------------+
 | Don Camillo  | peanuts           |
 | Tasty Pizzas | root beer         |
 +--------------+-------------------+
</code></pre>

<p>I'm not convinced that either of these ingredients belong anywhere near a pizza.</p>
