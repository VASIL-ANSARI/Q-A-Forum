<p>I suspect your problem is related to line feeds. Your strings when you hard code them don't include a line feed, but when you read them using <code>fgets()</code>, the way you are parsing them retains any trailing <code>\n</code>. It's possible that confuses whatever you're passing the value to to get that error.</p>

<p>Aside from that, you have a number of memory leaks in your code as the results of your <code>substring()</code> calls are never freed (and you don't even keep a pointer to them so they could be freed in some cases).</p>
