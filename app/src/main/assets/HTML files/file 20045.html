<p>USES_CONVERSION and related macros are the easiest way to do it. Why not use them? But you can always just check whether the UNICODE or _UNICODE macros are defined. If neither of them is defined, no conversion is necessary. If one of them is defined, you can use <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd319072%28v=vs.85%29.aspx" rel="nofollow">MultiByteToWideChar</a> to perform the conversion.</p>

<p>Actually that's a silly thing to do. JNIEnv alreay has a method to get the characters as Unicode: JNIEnv::GetStringChars. So just check for the UNICODE and _UNICODE macros to find out which method to use:</p>

<pre><code>#if defined(UNICODE) || defined(_UNICODE)
    LPTSTR lpszVal = env-&gt;GetStringChars(JavaStringVal, 0);
#else
    LPTSTR lpszVal = env-&gt;GetStringUTFChars(JavaStringVal, 0);
#endif
</code></pre>

<p>In fact, unless you want to pass the string to a method that expects a LPTSTR, you should just use the Unicode version only. Java strings are stored as Unicode internally, so you won't get the overhead of the conversion, plus Unicode strings are just better in general.</p>
