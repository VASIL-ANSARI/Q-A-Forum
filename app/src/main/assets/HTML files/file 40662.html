<p>The fact that you're calling <code>main</code> aside (you could just extract everything to a separate function), the problem is that when you enter something that a stream can't parse, it enters an error state where it returns from every operation immediately without doing anything. You need to check for the error state and reset the stream to get out of this.</p>
