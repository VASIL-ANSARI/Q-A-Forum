<p>Have a look at the documentation of <a href="http://www.php.net/manual/en/mysqli.query.php" rel="nofollow"><code>mysqli::query()</code></a></p>

<blockquote>
  <p>Returns FALSE on failure. </p>
</blockquote>

<p>Your code assumes that this won't happen. It just did. Handle that case:</p>

<pre><code>$query = $mysqli-&gt;query("SELECT * FROM valutazione WHERE email='$mail'"); 
if (! $query) {
    die("error");

}
$countresults = mysqli_num_rows($query);
</code></pre>

<hr>

<p>BTW have also a look at: <a href="http://stackoverflow.com/questions/60174">How can I prevent SQL injection in PHP?</a></p>
