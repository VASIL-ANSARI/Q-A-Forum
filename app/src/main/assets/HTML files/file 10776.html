<p>MSVC seems to be at fault; see this related question provided by jagansai above: <a href="http://stackoverflow.com/questions/6076015/typename-outside-of-template">typename outside of template</a></p>

<hr>

<p>Here is a workaround for <code>bar</code> which both compilers are happy with:</p>

<pre><code>template&lt;typename T&gt;
  typename foo&lt;T&gt;::type
    bar(T x)
{
  typedef typename foo&lt;T&gt;::type result_type;

  struct nested
  {
    inline static result_type baz(T x)
    {
      result_type result;
      return result;
    }
  };

  return nested::baz(x);
}
</code></pre>
