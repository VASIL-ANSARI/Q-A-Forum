<p><a href="https://developer.mozilla.org/en/DOM/window.onbeforeunload" rel="nofollow"><strong><code>window.onbeforeunload</code></strong></a> event is calls before your page is <a href="https://developer.mozilla.org/en/DOM/window.onunload" rel="nofollow"><code>unload</code></a>ed. 
There is no method to check if it's refresh or browser window close event. </p>

<p>It fires by different scenarios <sup><a href="http://msdn.microsoft.com/en-us/library/ms536907%28VS.85%29.aspx" rel="nofollow">MSDN</a></sup>:</p>

<ul>
<li>Close the current window.</li>
<li>Navigate to another location by entering a new address or selecting a Favorite.</li>
<li>Click an anchor that refers to another document.</li>
<li>Invoke the <code>anchor.click</code> method.</li>
<li>Invoke the <code>document.write</code> method.</li>
<li>Invoke the <code>document.close</code> method.</li>
<li>Invoke the <code>window.close</code> method.</li>
<li>Invoke the <code>window.navigate</code> or NavigateAndFind method.</li>
<li>Invoke the <code>location.replace</code> method.</li>
<li>Invoke the <code>location.reload</code> method.</li>
<li>Specify a new value for the <code>location.href</code> property.</li>
<li>Submit a form to the address specified in the ACTION attribute via the INPUT <code>type=submit</code> control, or invoke the <code>form.submit</code> method.</li>
<li>Invoke the <code>window.open</code> method, providing the possible value <code>_self</code> for the window name.</li>
<li>Invoke the <code>document.open</code> method.</li>
<li>Click the Back, Forward, Refresh, or Home button.</li>
</ul>

<p>And you can't handle this.</p>

<p>Also note that <code>window.onbeforeunload</code> event supposed to inform user that he leaves page and handler function should <code>return</code> string value that will be included in confirmation popup (except <code>Firefox 4+</code> see <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=588292" rel="nofollow">bug</a>).</p>

<p>You can not force the user to stay on the page.</p>

<p>Note: <strong>The only thing you can do with <code>onbeforeunload</code> is to notify the user that he is leaving your page</strong>
(this is because some <em>evil</em> pages can open another pages and so on... and spam users. This is security restriction).</p>

<p>If you want to make AJAX call before window is unloaded you need to use <code>onunload</code> event. Note that your AJAX call must me <strong>synchronus</strong>. Asynchronous call will not work.</p>
