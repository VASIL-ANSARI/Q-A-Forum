<p>You cannot obtain the location from the <code>handleActionWithIdentifier</code> method.  The purpose of the method is to handle the case of the user tapping a button in the options menu of a push notification.</p>

<p>If you would like to get the location of the user, you will need to ask for permission, which is why you put in one of the location keys in the plist.  It is possible to register for push notifications but not enable location services, which is why you cannot obtain the location as stated above.  </p>

<p>There are 3 possible cases that you can encounter that you can implement if necessary for your app:</p>

<ol>
<li><p>The user receives a push notification outside of the app (i.e. in background), taps on options, and taps on a button that does <strong>not</strong> open the app.  If you need to get location in this case, then you need to register for background fetch.  Otherwise, the action will not run until the app is next opened (who knows when), and the location could have changed.  The push notification package will need to include the necessary indicator to let the app know that there is content available.  Even if it is not the case that there is no content available, it will still give you an opportunity to run code in background such as obtain the location and do something with it.  This is the only case when you need to register for location updates in background (use NSLocationAlwaysUsageDescription as the key in the plist).</p></li>
<li><p>The user receives a push notification outside of the app (i.e. in background), taps on open or taps on options and then a button that opens the app.  In this case, you do not need background fetch.  The <code>handleActionWithIdentifier</code> will be called in the App Delegate if the user tapped a button in the options menu, and it will give you a chance to obtain the location from the location manager.  If the user tapped on the Open button, <code>didReceiveRemoteNotification</code> will be called in the App Delegate and again you have the opportunity.</p></li>
<li><p>The user receives a push notification while the app is active. In this case, the <code>didReceiveRemoteNotification</code> will be called in the App Delegate and again you have the opportunity to get the location from the Location Manager.</p></li>
</ol>

<p>Note: This assumes that the user has downloaded and opened the app at least once.  This will give you the chance to set up the Location Manager (and ask the user for permission).</p>

<p>Also note: If you need to handle the first case when the app is in background, there is a challenge to consider.  When the user force closes an app (which is surprisingly common because some people think this decreases the battery usage), there is zero opportunity to run any code before termination.  When the user receives the push notification, it will still be displayed.  But if the user taps on options and then taps on a button that does not open the app, no code tends to run even if you are registered for background fetch.  This is a very, very annoying case that there does not seem to be a good answer to.  </p>

<p>Hope this helps! </p>
