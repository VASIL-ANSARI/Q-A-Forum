<p>You need a <code>BEFORE DELETE</code> trigger on your <code>locations</code> table, something like the following:</p>

<pre><code>create trigger move_users
before delete
on locations
for each row
  update users
    set locationid = (select nearest from nearest where locationid = old.locationid)
  where locationid = old.locationid
</code></pre>

<p>Here's a <a href="http://sqlfiddle.com/#!9/3d60d/1" rel="nofollow">sqlfiddle</a> with some example data.</p>
