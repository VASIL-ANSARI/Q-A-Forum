<p>I believe you cannot use JTA transactions when you are outside a Java EE container (or at least there is no easy way to do this).</p>

<p><strong>Use RESOURCE-LOCAL</strong></p>

<p>There is nothing that requires JTA in your example: you are just looking up a data source in a Java SE environment. I think declaring your XA data source as <em>resource-local</em> would solve your problem. Put this in your <code>persistence.xml</code>:</p>

<pre><code>&lt;persistence-unit name="ContactBookPersistenceUnit" transaction-type="RESOURCE-LOCAL"&gt;
    [...]
    &lt;non-jta-data-source&gt;java:/ExampleDS&lt;/jta-data-source&gt;
</code></pre>

<p>I have not tested this code directly, but I have used a similar approach in web applications written for the Apache Tomcat server.</p>

<p>See also: <a href="http://piotrnowicki.com/2012/11/types-of-entitymanagers-application-managed-entitymanager/" rel="nofollow">Types of EntityManagers</a></p>

<p><strong>Use an embedded container</strong></p>

<p>Another option you may investigate involves starting an embedded Java EE container in you JUnit tests. Here are a couple of pointers, with examples for Glassfish 3:</p>

<ul>
<li><a href="http://www.adam-bien.com/roller/abien/entry/embedding_glassfish_v3_in_unit" rel="nofollow">Embededing Glassfish v3 in Unit Test</a></li>
<li><a href="http://embedded-glassfish.java.net/" rel="nofollow">Embedded Glassfish</a></li>
</ul>
